# Pachinko Lawtest - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆ

**æœ€çµ‚æ›´æ–°:** 2025-11-17
**ãƒ–ãƒ©ãƒ³ãƒ:** `claude/fix-vercel-kv-registration-01ALuL9dTijA2BygFtqW7kyj`
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** âŒ æœªè§£æ±º - ç™»éŒ²æ™‚ã«ã‚µãƒ¼ãƒãƒ¼é€šä¿¡ã‚¨ãƒ©ãƒ¼

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:** React 18.2.0
- **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:** React Router DOM 7.9.4
- **ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«:** Vite 4.5.0
- **ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥:** FingerprintJS 4.6.2
- **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ:** Capacitor 6.2.1 (iOS/Android)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ï¼‰
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°:** Vercel
- **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°:** Node.js (ES Modules)
- **Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯:** Express 5.1.0
- **Redisæ¥ç¶š:** ioredis 5.8.2
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:** Redis Cloud (redis-pink-notebook)

### ãƒ‡ãƒ—ãƒ­ã‚¤
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :** Vercel
- **ãƒªãƒã‚¸ãƒˆãƒª:** GitHub - pj0201/pachinko-lawtest
- **ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹å¼:** Git push â†’ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒï¼‰

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### ç›®çš„
ãƒ‘ãƒãƒ³ã‚³éŠæŠ€å ´ç®¡ç†è€…è©¦é¨“ã®æ¨¡æ“¬è©¦é¨“ã‚¢ãƒ—ãƒªï¼ˆã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å°‚ç”¨ï¼‰

### ä¸»ãªæ©Ÿèƒ½
1. **æ‹›å¾…URLåˆ¶é™ã‚·ã‚¹ãƒ†ãƒ **
   - 1æ‹›å¾…URL = 1ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãƒ‡ãƒã‚¤ã‚¹é–“ã§å…±æœ‰ï¼‰
   - ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ï¼ˆRedis Cloudï¼‰
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡é˜²æ­¢

2. **ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²**
   - FingerprintJSã§ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥
   - ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å°‚ç”¨åˆ¶é™ï¼ˆPC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆé™¤å¤–ï¼‰

3. **æ¨¡æ“¬è©¦é¨“**
   - é¢¨å–¶æ³•ãƒ»æ–½è¡Œè¦å‰‡ã®å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ626å•ï¼‰
   - æˆç¸¾å±¥æ­´ç®¡ç†

---

## ã“ã‚Œã¾ã§ã®ä¿®æ­£å†…å®¹ï¼ˆæ™‚ç³»åˆ—ï¼‰

### Phase 1: åˆæœŸå®Ÿè£…ï¼ˆVercel KVä½¿ç”¨ã‚’è©¦ã¿ãŸï¼‰

**ã‚³ãƒŸãƒƒãƒˆ:** `a0814e1` - `79aa5e7`

**å®Ÿæ–½å†…å®¹:**
- `ioredis` ã‹ã‚‰ `@vercel/kv` ã«ç§»è¡Œã‚’è©¦ã¿ãŸ
- `api/index.js` ã§Expressã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨
- ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ãƒ»ç™»éŒ²APIã‚’å®Ÿè£…

**çµæœ:** âŒ å¤±æ•—
- **ç†ç”±:** `redis-pink-notebook` ã¯ Vercel KV ã§ã¯ãªãã€Redis Cloud ã®é€šå¸¸ã®Redisãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã ã£ãŸ

---

### Phase 2: Redis Cloud ã¸ã®æ­£ã—ã„æ¥ç¶šï¼ˆioredis ã«æˆ»ã™ï¼‰

**ã‚³ãƒŸãƒƒãƒˆ:** `f9a1920` - `47fac1a`

**å®Ÿæ–½å†…å®¹:**
- `@vercel/kv` ã‚’å‰Šé™¤ã€`ioredis` ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- Redis Cloud æ¥ç¶šè¨­å®šã‚’è¿½åŠ ï¼ˆTLSå¯¾å¿œï¼‰
  ```javascript
  const redis = new Redis({
    host: 'redis-15687.c10.us-east-1-3.ec2.cloud.redislabs.com',
    port: 15687,
    password: process.env.REDIS_PASSWORD,
    tls: { rejectUnauthorized: false }
  });
  ```
- ç’°å¢ƒå¤‰æ•°ã‚’ `REDIS_HOST`, `REDIS_PORT`, `REDIS_PASSWORD` ã«å¤‰æ›´

**çµæœ:** âŒ éƒ¨åˆ†çš„ã«å‹•ä½œ
- `/api/health` ã®ã¿å‹•ä½œï¼ˆå€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã ã£ãŸãŸã‚ï¼‰
- Express ã‚¢ãƒ—ãƒªï¼ˆ`api/index.js`ï¼‰ãŒVercelã§å‹•ä½œã—ãªã„

---

### Phase 3: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å•é¡Œã®ä¿®æ­£

**ã‚³ãƒŸãƒƒãƒˆ:** `54792d5` - `b0d26c5`

**å®Ÿæ–½å†…å®¹:**
- `vercel.json` ã®rewriteãƒ«ãƒ¼ãƒ«ã‚’ä¿®æ­£
  ```json
  "source": "/((?!api).*)"  // APIã‚’é™¤å¤–
  ```
- APIãƒ«ãƒ¼ãƒˆã‹ã‚‰ `/api` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤
  - `app.get('/api/health')` â†’ `app.get('/health')`

**çµæœ:** âŒ ä¾ç„¶ã¨ã—ã¦å‹•ä½œã›ãš
- Express ã‚¢ãƒ—ãƒªãŒã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã¨ã—ã¦æ­£ã—ãå‹•ä½œã—ãªã„

---

### Phase 4: å€‹åˆ¥ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã¸ã®åˆ†å‰²

**ã‚³ãƒŸãƒƒãƒˆ:** `a875670` - `cb0f74b`

**å®Ÿæ–½å†…å®¹:**
- Express ã‚¢ãƒ—ãƒªã‚’å»ƒæ­¢
- å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã«åˆ†å‰²
  - `api/validate-token.js` - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
  - `api/register.js` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
  - `api/verify-session.js` - ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
  - `api/health.js` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
  - `api/test.js` - ãƒ†ã‚¹ãƒˆç”¨

- Redisæ¥ç¶šã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒç”¨ã«æœ€é©åŒ–
  ```javascript
  function createRedisClient() {
    return new Redis({
      connectTimeout: 10000,
      maxRetriesPerRequest: 3,
      retryStrategy: (times) => {
        if (times > 3) return null;
        return Math.min(times * 50, 2000);
      }
    });
  }

  // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…ã§æ¥ç¶šä½œæˆ
  const redis = createRedisClient();
  await redis.ping();
  // å‡¦ç†å¾Œã«ã‚¯ãƒ­ãƒ¼ã‚º
  await redis.quit();
  ```

**çµæœ:** âŒ ä¾ç„¶ã¨ã—ã¦å‹•ä½œã›ãš
- é–¢æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œæˆã—ãŸãŒã€`vercel.json` ã§ç™»éŒ²ã•ã‚Œã¦ã„ãªã‹ã£ãŸ

---

### Phase 5: vercel.json ã®ä¿®æ­£ï¼ˆæœ€æ–°ï¼‰

**ã‚³ãƒŸãƒƒãƒˆ:** `a7c6908` (ç¾åœ¨)

**å®Ÿæ–½å†…å®¹:**
- `vercel.json` ã® functions ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿®æ­£
  ```json
  "functions": {
    "api/**/*.js": {  // ã™ã¹ã¦ã®APIãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²
      "memory": 1024,
      "maxDuration": 10
    }
  }
  ```
  **Before:** `"api/index.js"` ã®ã¿
  **After:** `"api/**/*.js"` ã§å…¨é–¢æ•°ã‚’ç™»éŒ²

**çµæœ:** âš ï¸ æœªç¢ºèª
- GitHub PR #11 ãŒmainã«ãƒãƒ¼ã‚¸æ¸ˆã¿
- Vercelãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³ãŒä¸æ˜
- ã‚¹ãƒãƒ›ã§ã€Œã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€ã‚¨ãƒ©ãƒ¼ãŒç¶™ç¶š

---

## ç¾åœ¨ã®å•é¡Œ

### ç—‡çŠ¶

**ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‹ã‚‰æ‹›å¾…URLã§ç™»éŒ²ã‚’è©¦ã¿ã‚‹ã¨å¤±æ•—**

1. æ‹›å¾…URLã«ã‚¢ã‚¯ã‚»ã‚¹: https://pachinko-lawtest.vercel.app/invite/[token]
2. ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆæ­£å¸¸ï¼‰
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
4. ã€Œç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
5. ã€Œèª­ã¿è¾¼ã¿ä¸­...ã€è¡¨ç¤º
6. âŒ **ã‚¨ãƒ©ãƒ¼:** ã€Œã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€

### ç¢ºèªæ¸ˆã¿ã®å‹•ä½œçŠ¶æ³

#### âœ… å‹•ä½œã—ã¦ã„ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**1. `/api/health`**
```bash
GET https://pachinko-lawtest.vercel.app/api/health
```
**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "status": "ok",
  "timestamp": "2025-11-17T09:37:16.041Z",
  "service": "pachinko-exam-backend",
  "message": "API is working!"
}
```
âš ï¸ **å•é¡Œ:** Redisæ¥ç¶šæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ï¼ˆæœŸå¾…: `"redis": {"status": "connected"}`ï¼‰

**2. `/api/test`**
```bash
GET https://pachinko-lawtest.vercel.app/api/test
```
**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "message": "Test endpoint is working!",
  "method": "GET",
  "timestamp": "2025-11-17T09:37:35.311Z"
}
```

#### âŒ å‹•ä½œä¸æ˜ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**1. `/api/validate-token`**
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼ˆRegister.jsx:116ï¼‰
- ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¤œè¨¼
- Redis Cloudã§ä½¿ç”¨æ¸ˆã¿ãƒã‚§ãƒƒã‚¯

**2. `/api/register`**
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼ˆRegister.jsx:136ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’Redis Cloudã«ä¿å­˜

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

### APIé–¢æ•°ï¼ˆ/api ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

```
api/
â”œâ”€â”€ health.js           âœ… å‹•ä½œä¸­ï¼ˆãŸã ã—Redisæƒ…å ±ãªã—ï¼‰
â”œâ”€â”€ test.js             âœ… å‹•ä½œä¸­
â”œâ”€â”€ validate-token.js   â“ å‹•ä½œä¸æ˜ï¼ˆ404ã®å¯èƒ½æ€§ï¼‰
â”œâ”€â”€ register.js         â“ å‹•ä½œä¸æ˜ï¼ˆ404ã®å¯èƒ½æ€§ï¼‰
â”œâ”€â”€ verify-session.js   â“ å‹•ä½œä¸æ˜
â”œâ”€â”€ index.js            âš ï¸ æ—§Expressã‚¢ãƒ—ãƒªï¼ˆä½¿ç”¨ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ï¼‰
â””â”€â”€ auth/
    â””â”€â”€ register.py     ï¼ˆæœªä½¿ç”¨ï¼‰
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ/src ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

```
src/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ Register.jsx    ç™»éŒ²ãƒšãƒ¼ã‚¸ï¼ˆæ‹›å¾…URLå‡¦ç†ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Home.jsx        ãƒ›ãƒ¼ãƒ ç”»é¢
â”‚   â”œâ”€â”€ ExamScreen.jsx  è©¦é¨“ç”»é¢
â”‚   â””â”€â”€ ProtectedRoute.jsx  ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
â””â”€â”€ utils/
    â””â”€â”€ deviceCheck.js  ã‚¹ãƒãƒ›å°‚ç”¨ãƒã‚§ãƒƒã‚¯
```

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```
vercel.json            Vercelè¨­å®šï¼ˆfunctionså®šç¾©ï¼‰
package.json           ä¾å­˜é–¢ä¿‚
```

---

## ç’°å¢ƒå¤‰æ•°ï¼ˆVercelè¨­å®šæ¸ˆã¿ï¼‰

ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒVercelã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼ˆå…¨ç’°å¢ƒ: Production, Preview, Developmentï¼‰:

| å¤‰æ•°å | å€¤ | ç”¨é€” |
|--------|---|------|
| `REDIS_HOST` | `redis-15687.c10.us-east-1-3.ec2.cloud.redislabs.com` | Redis Cloudæ¥ç¶šå…ˆ |
| `REDIS_PORT` | `15687` | Redis Cloudãƒãƒ¼ãƒˆ |
| `REDIS_PASSWORD` | [è¨­å®šæ¸ˆã¿] | Redis Cloudèªè¨¼ |

---

## æ¬¡ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç¢ºèªã™ã¹ãé …ç›®

### ğŸ”´ æœ€å„ªå…ˆ: Vercel Deployments ç¢ºèª

1. **Vercel Dashboard ã«ã‚¢ã‚¯ã‚»ã‚¹**
   ```
   https://vercel.com/dashboard â†’ pachinko-lawtest
   ```

2. **Deployments ã‚¿ãƒ– â†’ æœ€æ–°ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã‚¯ãƒªãƒƒã‚¯**
   - **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥:** `c28ece6` (Merge PR #11) ã¾ãŸã¯ `a7c6908` ã‹ç¢ºèª
   - **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** "Ready" (ç·‘è‰²) ã«ãªã£ã¦ã„ã‚‹ã‹
   - **ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚åˆ»:** PR #11ãƒãƒ¼ã‚¸å¾Œï¼ˆæœ€æ–°ï¼‰ã‹

3. **Functions ã‚¿ãƒ–ã‚’ç¢ºèª**
   - **æœŸå¾…:** 5å€‹ã®é–¢æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
     - `api/health.js`
     - `api/test.js`
     - `api/validate-token.js` â† **é‡è¦**
     - `api/register.js` â† **é‡è¦**
     - `api/verify-session.js`

   - **ã‚‚ã—1å€‹ã ã‘è¡¨ç¤ºï¼ˆapi/index.jsï¼‰:**
     - å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹
     - "Redeploy" ã‚’å®Ÿè¡Œï¼ˆBuild Cacheã‚’ç„¡åŠ¹åŒ–ï¼‰

4. **Function Logs ã‚’ç¢ºèª**
   - ã‚¹ãƒãƒ›ã§ç™»éŒ²ã‚’è©¦ã¿ãŸæ™‚åˆ»ã®ãƒ­ã‚°ã‚’æ¤œç´¢
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:
     - `âŒ Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼`
     - `404 Not Found`
     - `500 Internal Server Error`

### ğŸŸ¡ APIå‹•ä½œãƒ†ã‚¹ãƒˆ

ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯curlã§ä»¥ä¸‹ã‚’ãƒ†ã‚¹ãƒˆ:

```bash
# 1. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼APIï¼ˆé‡è¦ï¼‰
curl -X POST https://pachinko-lawtest.vercel.app/api/validate-token \
  -H "Content-Type: application/json" \
  -d '{
    "token": "039742a2-f799-4574-8530-a8e1d81960f1",
    "email": "test@example.com"
  }'

# æœŸå¾…: {"valid": true, "message": "ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯æœ‰åŠ¹ã§ã™"}
# ã‚¨ãƒ©ãƒ¼: 404 Not Found = é–¢æ•°ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„
#        500 Internal Server Error = Redisæ¥ç¶šå¤±æ•—

# 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²APIï¼ˆé‡è¦ï¼‰
curl -X POST https://pachinko-lawtest.vercel.app/api/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "apitest@example.com",
    "username": "APIãƒ†ã‚¹ãƒˆ",
    "token": "039742a2-f799-4574-8530-a8e1d81960f1",
    "deviceId": "test-device-12345"
  }'

# æœŸå¾…: {"success": true, "sessionToken": "session_...", ...}
# ã‚¨ãƒ©ãƒ¼: 404 Not Found = é–¢æ•°ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„
#        400 Bad Request = ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼å¤±æ•—
#        500 Internal Server Error = Redisæ¥ç¶šå¤±æ•—
```

### ğŸŸ¢ Redisæ¥ç¶šç¢ºèª

1. **Redis Cloud Dashboard**
   - https://app.redislabs.com/
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: `redis-pink-notebook`
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ "Active" ã‹ç¢ºèª

2. **Vercelç’°å¢ƒå¤‰æ•°ã®å†ç¢ºèª**
   - Settings â†’ Environment Variables
   - `REDIS_PASSWORD` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
   - ã™ã¹ã¦ã®ç’°å¢ƒï¼ˆProduction, Preview, Developmentï¼‰ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹

---

## ãƒ‡ãƒãƒƒã‚°æƒ…å ±

### ã‚¹ãƒãƒ›ã§ã®ã‚¨ãƒ©ãƒ¼è©³ç´°

**ã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç®‡æ‰€:** `src/pages/Register.jsx:176-178`
```javascript
} catch (err) {
  console.error('âŒ ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', err);
  setError('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
}
```

**ã“ã®ã‚¨ãƒ©ãƒ¼ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹æ¡ä»¶:**
1. `fetch('/api/validate-token')` ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
2. `fetch('/api/register')` ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒJSONã§ã¯ãªã„ï¼ˆ404 HTMLç­‰ï¼‰
4. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

### ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®è©³ç´°

```
1. ã‚¹ãƒãƒ›ã§æ‹›å¾…URLã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. Register.jsx ãƒã‚¦ãƒ³ãƒˆ
   â†“
3. ãƒ‡ãƒã‚¤ã‚¹IDã‚’å–å¾—ï¼ˆFingerprintJSï¼‰
   â†“
4. ãƒˆãƒ¼ã‚¯ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«å…¥åŠ›ã—ã¦ã€Œç™»éŒ²ã€ã‚¿ãƒƒãƒ—
   â†“
6. POST /api/validate-token  â† ã“ã“ã§å¤±æ•—ã—ã¦ã„ã‚‹å¯èƒ½æ€§
   â†“
7. POST /api/register
   â†“
8. localStorage ã«ä¿å­˜
   â†“
9. ãƒ›ãƒ¼ãƒ ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

---

## æ‹›å¾…URLï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰

### UUID v4å½¢å¼ï¼ˆ10å€‹ï¼‰

1. https://pachinko-lawtest.vercel.app/invite/039742a2-f799-4574-8530-a8e1d81960f1
2. https://pachinko-lawtest.vercel.app/invite/cdfabd05-3fa5-4c49-87f0-a3a1aa03cdbb
3. https://pachinko-lawtest.vercel.app/invite/d0b28ab3-44b6-45aa-897b-e72e0e0da116
4. https://pachinko-lawtest.vercel.app/invite/babcd6fb-b8a8-46a8-b3a6-fc00966d07a3
5. https://pachinko-lawtest.vercel.app/invite/b1b281a3-6b76-4659-9827-bf3a07b6c3ba
6. https://pachinko-lawtest.vercel.app/invite/12f622c2-cbf4-4631-abb7-7336c841b198
7. https://pachinko-lawtest.vercel.app/invite/3c756c94-0d98-4d8b-b466-17e99f1b3240
8. https://pachinko-lawtest.vercel.app/invite/2b1d54e2-97a0-4900-a513-fab986540358
9. https://pachinko-lawtest.vercel.app/invite/d47c9566-cabd-4d96-91d0-41afc10a59b6
10. https://pachinko-lawtest.vercel.app/invite/c502c94a-3e4e-471e-9835-2f05018751e4

---

## ç–‘ã‚ã‚Œã‚‹æ ¹æœ¬åŸå› 

### ä»®èª¬1: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ï¼ˆæœ€æœ‰åŠ›ï¼‰

**è¨¼æ‹ :**
- `/api/health` ã¯å‹•ä½œã™ã‚‹ãŒã€Redisæƒ…å ±ãŒãªã„ï¼ˆå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
- `/api/validate-token`, `/api/register` ãŒ404ã®å¯èƒ½æ€§

**ç¢ºèªæ–¹æ³•:**
- Vercel Dashboard â†’ Functions ã‚¿ãƒ–ã§é–¢æ•°æ•°ã‚’ç¢ºèª
- 1å€‹ã ã‘ï¼ˆapi/index.jsï¼‰â†’ å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- 5å€‹è¡¨ç¤º â†’ æ­£ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³

**è§£æ±ºæ–¹æ³•:**
- Vercel Dashboard ã§ "Redeploy" ã‚’å®Ÿè¡Œï¼ˆBuild Cacheã‚’ç„¡åŠ¹åŒ–ï¼‰

---

### ä»®èª¬2: Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼

**è¨¼æ‹ :**
- `/api/health` ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«Redisæƒ…å ±ãŒãªã„

**ç¢ºèªæ–¹æ³•:**
- Function Logs ã§ `âŒ Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼` ã‚’æ¤œç´¢
- Redis Cloud ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª

**è§£æ±ºæ–¹æ³•:**
- ç’°å¢ƒå¤‰æ•° `REDIS_PASSWORD` ã‚’å†è¨­å®š
- Redis Cloud ã®IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆç¢ºèªï¼ˆVercel IPã‚’è¨±å¯ï¼‰

---

### ä»®èª¬3: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç¢ºèªæ–¹æ³•:**
- Vercel Dashboard â†’ Deployments â†’ æœ€æ–°ãƒ‡ãƒ—ãƒ­ã‚¤ â†’ "Building" ã‚¿ãƒ–
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `SMARTPHONE_TEST_GUIDE.md` - ã‚¹ãƒãƒ›ã§ã®ãƒ†ã‚¹ãƒˆæ‰‹é †æ›¸
- `REDIS_CLOUD_SETUP.md` - Redis Cloudæ¥ç¶šæ‰‹é †
- `INVITE_URL_TEST.md` - æ‹›å¾…URLåˆ¶é™ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

---

## é€£çµ¡å…ˆãƒ»ãƒªãƒã‚¸ãƒˆãƒª

- **GitHub:** https://github.com/pj0201/pachinko-lawtest
- **ãƒ–ãƒ©ãƒ³ãƒ:** `claude/fix-vercel-kv-registration-01ALuL9dTijA2BygFtqW7kyj`
- **Vercel:** https://vercel.com/dashboard (pachinko-lawtest)

---

**æœ€çµ‚æ›´æ–°:** 2025-11-17 09:37 UTC
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** ğŸ”´ æœªè§£æ±º - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹é–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ³è¦ç¢ºèª
