# Week 7 Phase 1: テスト生成（5問）

## 📋 実行準備チェック

**目的**: ディストラクタ・ひっかけ度改善が有効かをテスト（本生成前の品質検証）

**テスト対象**: 各テンプレートから1問ずつ、計5問
- T1 (基本知識): technology_T1_001
- T2 (条文直結): technology_T2_001  
- T3 (ひっかけ): technology_T3_001
- T4 (複合条件): technology_T4_001
- T5 (実務判断): technology_T5_001

---

## 🎯 Claude API呼び出し用プロンプト

### システムプロンプト（共通）

```
あなたは「遊技機取扱主任者試験」の高品質な問題生成AI です。

【重要】複合語取扱い指示（46個の用語）:
複合語は絶対に分割・変更してはいけません。以下の用語はそのままの形で使用してください：
営業許可, 型式検定, 営業禁止, 営業停止, 不正改造, 遊技機, 営業所, 営業者, 景品, 景品規制, 景品交換, 営業時間, 不正行為, 取消, 取消し要件, 失効, 申請, 申請手続き, 申請書, 公安委員会, 都道府県, 主基板, 外部端子, 基板ケース, かしめ, セキュリティ, 中古遊技機, リサイクル, 廃棄物, 製造業者, 販売業者, 設置, 新台設置, 点検, 点検確認, 保守管理, 製造番号, 立入検査, 行政処分, 罰則, 違反, チップ, 有効期間, 無期限有効, 3年有効, リサイクル推進法

【ディストラクタ（選択肢）の品質基準】

この指示を完全に守ってください。ディストラクタの品質が、
問題の品質スコアの約30%を占めます。

正答(A): 100% 正しい（根拠: 条文・教材から明確に導ける）
選択肢B: 学習者の典型的な誤り
  - 特徴: 似た用語の誤解（例: 型式検定と営業許可の混同）
  - 正答率: 40-60%の学習者が選ぶほどの説得力
選択肢C: 関連するが異なる概念
  - 特徴: テーマに関連するが別の規定
  - 正答率: 20-30%の学習者が選ぶ
選択肢D: 微妙な誤り
  - 特徴: 一部は正しいが条件や範囲が異なる
  - 正答率: 5-20%の学習者のみが選ぶ（上級者向け）

【ひっかけ度制御】

テンプレート別に、正答の選択率を以下に制御してください：

T1: 正答選択率 85% （ひっかけ度 15%）
T2: 正答選択率 65% （ひっかけ度 35%）
T3: 正答選択率 55% （ひっかけ度 45%）
T4: 正答選択率 65% （ひっかけ度 35%）
T5: 正答選択率 55% （ひっかけ度 45%）

【品質チェックリスト】

各問題を生成した後、以下を確認してください：

☑ 正答は根拠が明確か（条文・教材から導ける）
☑ 選択肢B は「学習者の典型的な誤解」か（似た用語の混同など）
☑ 選択肢C は「関連するが異なる概念」か
☑ 選択肢D は「微妙な誤り」か（詳しい者のみ判別可能）
☑ 4択すべてに「選ばれる可能性」があるか
☑ ひっかけ度がテンプレート別目標値に近いか
☑ 複合語46個の分割・変更がないか
☑ 説明文は根拠を明示しているか
```

---

## 📝 ユーザープロンプト（テンプレート別）

### T1 (基本知識) - 1問テスト生成

```
技術管理分野のT1 (基本知識)テンプレートで、難易度「基礎」の問題を1問生成してください。

【重要な指示】
- ひっかけ度: 10-20%の範囲内（正答選択率 80-90%）
- 大多数の学習者が正答を選べる明確な問題にしてください
- 選択肢B: 学習者の典型的な誤り（似た概念との混同）

【チャンクコンテキスト】
主基板管理、型式検定の基本、遊技機の基本要件

【品質基準】
- 正答: 確実に正しい（根拠: 基本原則など）
- 選択肢B: 似た概念だが異なる（XX と混同しやすい）
- 選択肢C: 関連概念だが別（XX に関連するが異なる）
- 選択肢D: 微妙な誤り（一部は正しいが YY が不正確）

JSON形式で以下の構造で返してください：
{
  "problem_id": "technology_T1_001",
  "domain": "technology",
  "template": "T1",
  "difficulty": "基礎",
  "question": "...",
  "options": {
    "A": "... （正答）",
    "B": "... （典型的な誤り）",
    "C": "... （関連概念の誤り）",
    "D": "... （微妙な誤り）"
  },
  "correct_answer": "A",
  "explanation": "...",
  "source_theme": "theme_025",
  "compound_words_used": ["複合語1"]
}
```

### T2 (条文直結) - 1問テスト生成

```
技術管理分野のT2 (条文直結)テンプレートで、難易度「標準」の問題を1問生成してください。

【重要な指示】
- ひっかけ度: 30-40%の範囲内（正答選択率 60-70%）
- 標準難易度: 正答には理由があるが、誤りも説得力あり
- 選択肢B-D: すべてに「選ばれる可能性」を持たせてください

【品質基準】
- 正答: 条文に基づく（根拠: 風営法・規則など）
- 選択肢B: 似た条項だが異なる（XX条と混同）
- 選択肢C: 関連する別の規定（YY について規定）
- 選択肢D: 微妙な違い（一部は正しいが ZZ が異なる）

[T1と同じJSON形式で返してください]
```

### T3 (ひっかけ) - 1問テスト生成

```
技術管理分野のT3 (ひっかけ)テンプレートで、難易度「応用」の問題を1問生成してください。

【重要な指示】
- ひっかけ度: 40-50%の範囲内（正答選択率 50-60%）
- 応用難易度: 4択すべてに説得力、慎重な判断が必要
- ディストラクタの品質: 正答と同等レベルの根拠を持たせてください

【品質チェックリスト】
☑ 正答は根拠が明確か（条文から導ける）
☑ 選択肢B: 学習者の典型的な誤解か（誤りが自然か）
☑ 選択肢C: 関連するが異なるか
☑ 選択肢D: 微妙な誤りか（詳しい者のみ判別可能）
☑ 4択すべてに「選ばれる可能性」があるか

[T1と同じJSON形式で返してください]
```

### T4 (複合条件) - 1問テスト生成

```
技術管理分野のT4 (複合条件)テンプレートで、難易度「標準」の問題を1問生成してください。

【重要な指示】
- ひっかけ度: 30-40%の範囲内（正答選択率 60-70%）
- 複数条件で混同させるが標準難易度
- 選択肢: 条件を部分的に誤った解釈を含める

【品質基準】
- 正答: AND/OR条件で全て正確
- 選択肢B: 条件を一つ誤った（AはいいがBが誤り）
- 選択肢C: 別の条件組み合わせ（異なるシナリオ）
- 選択肢D: 一部条件のみ満たす（部分的）

[T1と同じJSON形式で返してください]
```

### T5 (実務判断) - 1問テスト生成

```
技術管理分野のT5 (実務判断)テンプレートで、難易度「応用」の問題を1問生成してください。

【重要な指示】
- ひっかけ度: 40-50%の範囲内（正答選択率 50-60%）
- 応用難易度: 実務知識を要する
- 選択肢: 実務で実際に起こりやすい誤りを含める

【品質基準】
- 正答: 実務的に正しい対応
- 選択肢B: 実務で起こりやすい誤解（経験者も迷う）
- 選択肢C: 似た状況だが異なる対応（別シナリオ）
- 選択肢D: 誤った判断（不完全な理解）

[T1と同じJSON形式で返してください]
```

---

## 🚀 実行手順

### 手順1: 各テンプレート別に上記プロンプトでClaude APIを呼び出し

```bash
# 結果を output/technology_domain_test_5problems.json に保存
# 形式: 1行ごとにJSON（改行区切り）
```

### 手順2: 品質評価（自動化可能）

```bash
# 生成された5問について以下を確認：
□ 複合語が46個から正確に使用されているか
□ ひっかけ度がテンプレート別範囲内か（15%, 35%, 45%, 35%, 45%）
□ 選択肢構成が4階層構造か（正答, 典型的誤り, 関連概念誤り, 微妙誤り）
□ JSON形式が正しいか
```

### 手順3: 改善判定

```bash
# 品質評価結果に基づいて：
✅ 合格: Phase 3本生成へ進む
⚠️ 要改善: Phase 2でプロンプト調整後、再テスト
```

---

## 📊 テスト生成出力形式

```jsonl
{"problem_id": "technology_T1_001", "domain": "technology", "template": "T1", ...}
{"problem_id": "technology_T2_001", "domain": "technology", "template": "T2", ...}
{"problem_id": "technology_T3_001", "domain": "technology", "template": "T3", ...}
{"problem_id": "technology_T4_001", "domain": "technology", "template": "T4", ...}
{"problem_id": "technology_T5_001", "domain": "technology", "template": "T5", ...}
```

---

**次ステップ**: 上記プロンプトでClaude APIを呼び出し、5問を生成してください
