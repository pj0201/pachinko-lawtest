# 統合レビュー・修正システム実装計画
作成日: 2025-10-23
実装者: Worker3 (Claude Sonnet 4.5)
目的: 900問の完全レビューと品質向上

---

## 📋 完成した設計ドキュメント

1. ✅ `REVIEW_ISSUES_20251023.md` - 指摘内容の体系的整理
2. ✅ `LEGAL_EXAM_RESEARCH_20251023.md` - 法律系正誤式問題リサーチ
3. ✅ `DUPLICATE_DETECTION_DESIGN.md` - 重複検出アルゴリズム設計
4. ✅ `CATEGORY_VALIDATION_DESIGN.md` - カテゴリ適切性チェック設計
5. ✅ `LEGAL_REFERENCE_ENHANCEMENT_DESIGN.md` - 法的根拠具体化設計
6. ✅ `SPECIFICITY_CHECK_DESIGN.md` - 問題文具体性チェック設計

---

## 🎯 実装する機能

### Phase 1: 重複検出システム
**ファイル**: `backend/problem-duplicate-detector.js`

**機能**:
- Layer 1: キーワードベース高速検出（Jaccard係数）
- Layer 2: 編集距離確認（Levenshtein距離）
- Layer 3: 正誤逆転パターン検出
- 重複レポート生成（JSON + Markdown）

**期待される結果**:
- 900問 → 約35件の重複検出
- 処理時間: 5分以内

---

### Phase 2: カテゴリ適切性チェック
**ファイル**: `backend/category-validator.js`

**機能**:
- 許容される法令のホワイトリストチェック
- 除外すべき法令のブラックリストチェック
- カテゴリと法令の対応確認
- 自動修正・削除推奨の判定

**期待される結果**:
- 不適合問題: 約50件検出
- 自動修正: 約15件
- 削除推奨: 約35件

---

### Phase 3: 法的根拠具体化
**ファイル**: `backend/legal-reference-enhancer.js`

**機能**:
- 法的根拠の分析（具体性スコア計算）
- キーワードから条文を推測
- 条文の存在確認
- フォーマット統一

**期待される結果**:
- 補完必要: 約400問
- 補完成功率: 90%（約360問）
- 手動レビュー必要: 約40問

---

### Phase 4: 問題文具体性チェック
**ファイル**: `backend/specificity-enhancer.js`

**機能**:
- 具体性スコア計算（7つの観点）
- 指示語の自動置換
- 主語・述語の補完
- 数値の具体化

**期待される結果**:
- 要改善: 約150問
- 平均スコア向上: +13.8点

---

### Phase 5: 統合マスターシステム
**ファイル**: `backend/master-review-system.js`

**機能**:
- 全4システムの順次実行
- 統合レポート生成
- 修正前後の比較
- 最終データの出力

---

## 🚀 実装順序

### Step 1: 依存関係のインストール（5分）
```bash
cd /home/planj/patshinko-exam-app
npm install --save \
  tiny-segmenter \
  natural \
  string-similarity
```

### Step 2: 各モジュールの実装（3-4時間）
1. `problem-duplicate-detector.js` - 1時間
2. `category-validator.js` - 1時間
3. `legal-reference-enhancer.js` - 1時間
4. `specificity-enhancer.js` - 1時間

### Step 3: マスターシステムの実装（30分）
- 統合フロー構築
- エラーハンドリング
- ログ出力

### Step 4: テスト実行（30分）
- 小規模データでテスト（50問）
- バグ修正
- パフォーマンス確認

### Step 5: 本番実行（10分）
- 900問への適用
- レポート生成
- バックアップ作成

---

## 📊 実行フロー

```
【開始】 900問読み込み
    ↓
┌─────────────────────────────────┐
│ Phase 1: 重複検出               │
│ - 検出: 35件                    │
│ - 除去: 35問                    │
│ → 残り: 865問                   │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ Phase 2: カテゴリ適切性チェック │
│ - 不適合: 50件                  │
│ - 自動修正: 15件                │
│ - 削除: 35件                    │
│ → 残り: 830問                   │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ Phase 3: 法的根拠具体化         │
│ - 補完成功: 360問               │
│ - 手動レビュー: 40問            │
│ → すべて処理                    │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ Phase 4: 問題文具体性向上       │
│ - 改善: 150問                   │
│ - 平均スコア: +13.8点           │
│ → すべて処理                    │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ 【最終結果】                    │
│ - 最終問題数: 約830問           │
│ - 削除: 70問                    │
│ - 改善: 約525問                 │
│ - 品質スコア: 平均82点以上      │
└─────────────────────────────────┘
    ↓
【完了】 レポート生成・データ保存
```

---

## 📁 出力ファイル

### データファイル
```
/home/planj/patshinko-exam-app/data/
├── opus_900_original.json                    # バックアップ（元データ）
├── opus_830_reviewed_20251023.json           # レビュー後データ
└── public/
    └── mock_problems_opus_reviewed.json      # 公開用データ
```

### レポートファイル
```
/home/planj/patshinko-exam-app/reports/
├── duplicate_report_20251023.md              # 重複検出レポート
├── category_validation_20251023.md           # カテゴリ検証レポート
├── legal_reference_report_20251023.md        # 法的根拠補完レポート
├── specificity_report_20251023.md            # 具体性向上レポート
└── master_review_report_20251023.md          # 統合レポート
```

---

## 🎯 品質目標（達成状況）

| 項目 | 目標 | 予想達成値 |
|------|------|-----------|
| 重複問題 | 0件 | 0件 ✅ |
| カテゴリ適合率 | 100% | 100% ✅ |
| 法的根拠明記率 | 100% | 95%以上 ✅ |
| 具体性スコア | 80点以上 | 82点以上 ✅ |
| 最終問題数 | 800-850問 | 約830問 ✅ |

---

## ⚠️ 注意事項

### 1. バックアップの必須化
```bash
# 実行前に必ずバックアップ
cp data/opus_900_expanded_20251023_114422.json \
   data/opus_900_original.json
```

### 2. 段階的な実行
- 各Phaseごとに結果を確認
- 問題があれば即座に中断
- ロールバック可能な設計

### 3. 手動レビューの残存
以下は必ず人間がレビュー:
- 削除推奨問題（約35件）
- 法的根拠が自動補完できなかった問題（約40件）
- 具体性スコアが60点未満の問題（残存する場合）

---

## 🔗 次のステップ

1. ✅ 実装計画書完成
2. → 依存パッケージのインストール
3. → 各モジュールの実装
4. → 統合テスト
5. → 本番実行
6. → レポート確認と手動レビュー

---

## 📞 実装開始の承認待ち

**準備完了しました。実装を開始してよろしいですか？**

実装には約4-5時間かかります。以下の順序で進めます：
1. npm依存パッケージインストール
2. 4つのモジュール実装
3. マスターシステム実装
4. テスト実行
5. 本番900問への適用

承認いただければ、即座に開始します。
