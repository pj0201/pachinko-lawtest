<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPUSå•é¡Œãƒ“ãƒ¥ãƒ¼ã‚¢ - éŠæŠ€æ©Ÿå–æ‰±ä¸»ä»»è€…è©¦é¨“</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            flex-wrap: wrap;
        }

        .controls select, .controls input, .controls button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .controls button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .controls button:hover {
            background: #5a67d8;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f0f4f8;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-card .label {
            color: #666;
            margin-top: 5px;
        }

        .problem-list {
            padding: 20px;
        }

        .problem-item {
            background: white;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: box-shadow 0.3s;
        }

        .problem-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .problem-number {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        .problem-meta {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .category-badge {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .difficulty-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .difficulty-badge.easy {
            background: #d4f4e7;
            color: #22c55e;
        }

        .difficulty-badge.medium {
            background: #fef3c7;
            color: #f59e0b;
        }

        .difficulty-badge.hard {
            background: #fee2e2;
            color: #ef4444;
        }

        .problem-statement {
            font-size: 1.1em;
            line-height: 1.6;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 4px;
        }

        .problem-answer {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }

        .answer-option {
            padding: 10px 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer-option:hover {
            background: #f0f4f8;
        }

        .answer-option.correct {
            background: #d4f4e7;
            border-color: #22c55e;
            color: #22c55e;
            font-weight: bold;
        }

        .answer-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
            color: #ef4444;
        }

        .problem-explanation {
            padding: 15px;
            background: #e8f4fd;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
            margin-top: 15px;
            display: none;
        }

        .problem-explanation.show {
            display: block;
        }

        .problem-source {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
        }

        .pagination button {
            padding: 8px 15px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination button:hover {
            background: #667eea;
            color: white;
        }

        .pagination button.active {
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }

            .problem-header {
                flex-direction: column;
                align-items: start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ OPUSå•é¡Œãƒ“ãƒ¥ãƒ¼ã‚¢</h1>
            <p>éŠæŠ€æ©Ÿå–æ‰±ä¸»ä»»è€…è©¦é¨“ - é«˜å“è³ª900å•ã‚»ãƒƒãƒˆ</p>
        </div>

        <div class="controls">
            <select id="categoryFilter">
                <option value="">å…¨ã‚«ãƒ†ã‚´ãƒª</option>
                <option value="éŠæŠ€æ©Ÿç®¡ç†">éŠæŠ€æ©Ÿç®¡ç†</option>
                <option value="ä¸æ­£å¯¾ç­–">ä¸æ­£å¯¾ç­–</option>
                <option value="å–¶æ¥­è¨±å¯é–¢é€£">å–¶æ¥­è¨±å¯é–¢é€£</option>
                <option value="å–¶æ¥­æ™‚é–“ãƒ»è¦åˆ¶">å–¶æ¥­æ™‚é–“ãƒ»è¦åˆ¶</option>
                <option value="å‹å¼æ¤œå®šé–¢é€£">å‹å¼æ¤œå®šé–¢é€£</option>
                <option value="æ™¯å“è¦åˆ¶">æ™¯å“è¦åˆ¶</option>
            </select>

            <select id="difficultyFilter">
                <option value="">å…¨é›£æ˜“åº¦</option>
                <option value="easy">æ˜“ã—ã„</option>
                <option value="medium">æ™®é€š</option>
                <option value="hard">é›£ã—ã„</option>
            </select>

            <input type="text" id="searchBox" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢...">

            <button onclick="applyFilters()">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨</button>
            <button onclick="resetFilters()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button onclick="showRandomProblem()">ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤º</button>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="number" id="totalCount">-</div>
                <div class="label">ç·å•é¡Œæ•°</div>
            </div>
            <div class="stat-card">
                <div class="number" id="displayCount">-</div>
                <div class="label">è¡¨ç¤ºä¸­</div>
            </div>
            <div class="stat-card">
                <div class="number" id="correctRate">-</div>
                <div class="label">æ­£ç­”ç‡</div>
            </div>
            <div class="stat-card">
                <div class="number" id="currentPage">-</div>
                <div class="label">ãƒšãƒ¼ã‚¸</div>
            </div>
        </div>

        <div class="problem-list" id="problemList">
            <div class="loading">å•é¡Œã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>

        <div class="pagination" id="pagination"></div>
    </div>

    <script>
        let allProblems = [];
        let filteredProblems = [];
        let currentPage = 1;
        const problemsPerPage = 10;
        let userAnswers = {};

        // å•é¡Œãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        async function loadProblems() {
            try {
                const response = await fetch('public/mock_problems_opus_final.json');
                const data = await response.json();
                allProblems = data.problems;
                filteredProblems = [...allProblems];

                updateStats();
                displayProblems();
            } catch (error) {
                console.error('Error loading problems:', error);
                document.getElementById('problemList').innerHTML =
                    '<div class="error">âš ï¸ å•é¡Œã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        function updateStats() {
            document.getElementById('totalCount').textContent = allProblems.length;
            document.getElementById('displayCount').textContent = filteredProblems.length;

            const correctCount = Object.values(userAnswers).filter(a => a.correct).length;
            const totalAnswered = Object.keys(userAnswers).length;
            const rate = totalAnswered > 0 ? Math.round((correctCount / totalAnswered) * 100) : '-';
            document.getElementById('correctRate').textContent = rate + '%';

            document.getElementById('currentPage').textContent = `${currentPage}/${Math.ceil(filteredProblems.length / problemsPerPage)}`;
        }

        // å•é¡Œã®è¡¨ç¤º
        function displayProblems() {
            const startIndex = (currentPage - 1) * problemsPerPage;
            const endIndex = startIndex + problemsPerPage;
            const problemsToDisplay = filteredProblems.slice(startIndex, endIndex);

            let html = '';
            problemsToDisplay.forEach((problem, index) => {
                const globalIndex = startIndex + index;
                html += createProblemHTML(problem, globalIndex);
            });

            document.getElementById('problemList').innerHTML = html;
            updatePagination();
            updateStats();
        }

        // å•é¡ŒHTMLã®ç”Ÿæˆ
        function createProblemHTML(problem, index) {
            const difficultyMap = {
                'easy': 'æ˜“ã—ã„',
                'medium': 'æ™®é€š',
                'hard': 'é›£ã—ã„'
            };

            return `
                <div class="problem-item">
                    <div class="problem-header">
                        <div class="problem-number">å•é¡Œ ${problem.id}</div>
                        <div class="problem-meta">
                            <span class="category-badge">${problem.category}</span>
                            <span class="difficulty-badge ${problem.difficulty}">
                                ${difficultyMap[problem.difficulty] || problem.difficulty}
                            </span>
                        </div>
                    </div>

                    <div class="problem-statement">
                        ${problem.statement}
                    </div>

                    <div class="problem-answer">
                        <div class="answer-option" onclick="checkAnswer('${problem.id}', true, ${index})">
                            â—‹ æ­£ã—ã„
                        </div>
                        <div class="answer-option" onclick="checkAnswer('${problem.id}', false, ${index})">
                            Ã— é–“é•ã„
                        </div>
                    </div>

                    <div class="problem-explanation" id="explanation-${index}">
                        <strong>è§£èª¬:</strong> ${problem.explanation}
                        ${problem.source ? `<div class="problem-source">å‡ºå…¸: ${problem.source}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ç­”ãˆåˆã‚ã›
        function checkAnswer(problemId, userAnswer, index) {
            const problem = filteredProblems.find(p => p.id === problemId);
            const isCorrect = problem.answer === userAnswer;

            userAnswers[problemId] = { answer: userAnswer, correct: isCorrect };

            const options = document.querySelectorAll(`.problem-item:nth-child(${index + 1}) .answer-option`);
            options.forEach(option => {
                option.onclick = null;
                if (option.textContent.includes('æ­£ã—ã„')) {
                    option.classList.add(problem.answer ? 'correct' : 'incorrect');
                } else {
                    option.classList.add(!problem.answer ? 'correct' : 'incorrect');
                }
            });

            document.getElementById(`explanation-${index}`).classList.add('show');
            updateStats();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function applyFilters() {
            const category = document.getElementById('categoryFilter').value;
            const difficulty = document.getElementById('difficultyFilter').value;
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();

            filteredProblems = allProblems.filter(problem => {
                const categoryMatch = !category || problem.category === category;
                const difficultyMatch = !difficulty || problem.difficulty === difficulty;
                const searchMatch = !searchTerm ||
                    problem.statement.toLowerCase().includes(searchTerm) ||
                    problem.explanation.toLowerCase().includes(searchTerm);

                return categoryMatch && difficultyMatch && searchMatch;
            });

            currentPage = 1;
            displayProblems();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
        function resetFilters() {
            document.getElementById('categoryFilter').value = '';
            document.getElementById('difficultyFilter').value = '';
            document.getElementById('searchBox').value = '';
            filteredProblems = [...allProblems];
            currentPage = 1;
            displayProblems();
        }

        // ãƒ©ãƒ³ãƒ€ãƒ å•é¡Œè¡¨ç¤º
        function showRandomProblem() {
            const randomIndex = Math.floor(Math.random() * filteredProblems.length);
            currentPage = Math.floor(randomIndex / problemsPerPage) + 1;
            displayProblems();
        }

        // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
        function updatePagination() {
            const totalPages = Math.ceil(filteredProblems.length / problemsPerPage);
            let html = '';

            html += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>å‰ã¸</button>`;

            for (let i = 1; i <= Math.min(totalPages, 5); i++) {
                if (currentPage > 3) {
                    const pageNum = currentPage - 3 + i;
                    if (pageNum <= totalPages) {
                        html += `<button onclick="changePage(${pageNum})" class="${pageNum === currentPage ? 'active' : ''}">${pageNum}</button>`;
                    }
                } else {
                    html += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
                }
            }

            html += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>æ¬¡ã¸</button>`;

            document.getElementById('pagination').innerHTML = html;
        }

        // ãƒšãƒ¼ã‚¸å¤‰æ›´
        function changePage(page) {
            const totalPages = Math.ceil(filteredProblems.length / problemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayProblems();
                window.scrollTo(0, 0);
            }
        }

        // åˆæœŸåŒ–
        loadProblems();
    </script>
</body>
</html>