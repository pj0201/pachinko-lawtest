<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒã‚¤ã‚¹ãƒã‚§ãƒƒã‚¯ ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        h2 { margin-top: 30px; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        td { padding: 8px; border: 1px solid #ddd; }
        td:first-child { font-weight: bold; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸ“± ãƒ‡ãƒã‚¤ã‚¹åˆ¶é™ãƒã‚§ãƒƒã‚¯ ãƒ†ã‚¹ãƒˆ</h1>

    <div class="info test-result">
        <h3>ç¾åœ¨ã®ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±</h3>
        <table id="deviceInfo"></table>
    </div>

    <div id="testResult"></div>

    <h2>ãƒ†ã‚¹ãƒˆé …ç›®</h2>
    <div id="tests"></div>

    <script type="module">
        // deviceCheck.js ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚³ãƒ”ãƒ¼
        function isMobileDevice() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);

            const hasTouchScreen = (
                'ontouchstart' in window ||
                navigator.maxTouchPoints > 0 ||
                navigator.msMaxTouchPoints > 0
            );

            const isSmallScreen = window.innerWidth <= 768;

            return isMobileUA && hasTouchScreen && isSmallScreen;
        }

        function checkDeviceRestriction() {
            if (!isMobileDevice()) {
                return {
                    allowed: false,
                    message: 'ã“ã®ã‚¢ãƒ—ãƒªã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å°‚ç”¨ã§ã™ã€‚\\nã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚'
                };
            }

            return {
                allowed: true,
                message: ''
            };
        }

        // ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã‚’è¡¨ç¤º
        const userAgent = navigator.userAgent.toLowerCase();
        const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
        const hasTouchScreen = (
            'ontouchstart' in window ||
            navigator.maxTouchPoints > 0 ||
            navigator.msMaxTouchPoints > 0
        );
        const isSmallScreen = window.innerWidth <= 768;

        const deviceInfo = `
            <tr><td>User-Agent</td><td>${navigator.userAgent}</td></tr>
            <tr><td>ãƒ¢ãƒã‚¤ãƒ«UAåˆ¤å®š</td><td>${isMobileUA ? 'âœ… ãƒ¢ãƒã‚¤ãƒ«' : 'âŒ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—'}</td></tr>
            <tr><td>ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³</td><td>${hasTouchScreen ? 'âœ… å¯¾å¿œ' : 'âŒ éå¯¾å¿œ'}</td></tr>
            <tr><td>maxTouchPoints</td><td>${navigator.maxTouchPoints || 0}</td></tr>
            <tr><td>ç”»é¢æ¨ªå¹…</td><td>${window.innerWidth}px ${isSmallScreen ? 'âœ… (â‰¤768px)' : 'âŒ (>768px)'}</td></tr>
            <tr><td>ç”»é¢ç¸¦å¹…</td><td>${window.innerHeight}px</td></tr>
        `;
        document.getElementById('deviceInfo').innerHTML = deviceInfo;

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        const result = checkDeviceRestriction();
        const resultDiv = document.getElementById('testResult');

        if (result.allowed) {
            resultDiv.innerHTML = `
                <div class="success test-result">
                    <h3>âœ… ãƒ†ã‚¹ãƒˆçµæœ: ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯</h3>
                    <p>ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã—ãŸã€‚</p>
                    <p><strong>ã‚¢ãƒ—ãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚</strong></p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="error test-result">
                    <h3>âŒ ãƒ†ã‚¹ãƒˆçµæœ: ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦</h3>
                    <p><strong>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong></p>
                    <pre>${result.message}</pre>
                    <p><strong>ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã¯ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚</strong></p>
                </div>
            `;
        }

        // å€‹åˆ¥ãƒ†ã‚¹ãƒˆ
        const tests = [
            {
                name: 'User-Agent ãƒã‚§ãƒƒã‚¯',
                passed: isMobileUA,
                description: 'ãƒ¢ãƒã‚¤ãƒ«OSã®User-AgentãŒæ¤œå‡ºã•ã‚Œã‚‹ã‹'
            },
            {
                name: 'ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ ãƒã‚§ãƒƒã‚¯',
                passed: hasTouchScreen,
                description: 'ã‚¿ãƒƒãƒæ“ä½œã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹'
            },
            {
                name: 'ç”»é¢ã‚µã‚¤ã‚º ãƒã‚§ãƒƒã‚¯',
                passed: isSmallScreen,
                description: 'ç”»é¢æ¨ªå¹…ãŒ768pxä»¥ä¸‹ã‹'
            },
            {
                name: 'ç·åˆåˆ¤å®š',
                passed: isMobileUA && hasTouchScreen && isSmallScreen,
                description: 'ã™ã¹ã¦ã®æ¡ä»¶ã‚’æº€ãŸã™ã‹ï¼ˆANDæ¡ä»¶ï¼‰'
            }
        ];

        const testsDiv = document.getElementById('tests');
        tests.forEach(test => {
            const testHtml = `
                <div class="${test.passed ? 'success' : 'error'} test-result">
                    <h4>${test.passed ? 'âœ…' : 'âŒ'} ${test.name}</h4>
                    <p>${test.description}</p>
                    <p><strong>çµæœ:</strong> ${test.passed ? 'åˆæ ¼' : 'ä¸åˆæ ¼'}</p>
                </div>
            `;
            testsDiv.innerHTML += testHtml;
        });

        // Chrome DevTools ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã®æ³¨æ„
        if (!isMobileUA && hasTouchScreen) {
            testsDiv.innerHTML += `
                <div class="info test-result">
                    <h4>âš ï¸ æ³¨æ„: Chrome DevTools ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h4>
                    <p>Chrome DevTools ã®ãƒ‡ãƒã‚¤ã‚¹ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã¯æœ‰åŠ¹ã«ãªã‚Šã¾ã™ãŒã€User-AgentãŒå¤‰æ›´ã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</p>
                    <p><strong>å¯¾ç­–:</strong> DevTools ã®è¨­å®šã§ã€ŒUser-Agentã€ã‚‚å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            `;
        }
    </script>
</body>
</html>
