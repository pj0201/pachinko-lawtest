# 📋 480問修正フロー - 完全ドキュメント

**作成日**: 2025-10-26
**対象**: PROBLEMS_FINAL_1491.json の 480問
**ステータス**: 修正フロー計画書（実行前）

---

## 🎯 全体目標

```
【Phase 1】480問の条文・問題文修正
  ├─ 条文引用の修正（legal_reference.article）
  └─ 問題文の修正（必要に応じて）

【Phase 2】修正完了後の網羅性確認
  ├─ どの条文がカバーされているか把握
  ├─ 風営法すべての条文を確認
  └─ 未出題条文の特定
```

---

## 📊 不一致問題の構成（再確認）

```
第6条:      383/383問 (100.0% 不一致)
第4条:        8/8問   (100.0% 不一致)
第8条:       18/18問  (100.0% 不一致)
第9条:        6/6問   (100.0% 不一致)
第26条:      45/65問  (69.2% 不一致)
第6条の2:   20/32問  (62.5% 不一致)
───────────────────────────
合計:       480問     (75.2% 不一致)
```

---

## 🔧 Phase 1: 修正実行ステップ

### ステップ 1: 480問をグループ化

**条文ごとのバッチ分け:**
```
第6条（383問）
  → 20問/バッチ × 19バッチ + 3問 = 19バッチ
  → 実行: Worker3（メイン担当）

第4条（8問）
  → 1バッチ
  → 実行: Worker2

第8条（18問）
  → 2バッチ（9問/バッチ）
  → 実行: Worker2

第9条（6問）
  → 1バッチ
  → 実行: Worker2

第26条（45問）
  → 5バッチ（9問/バッチ）
  → 実行: Worker3

第6条の2（20問）
  → 2バッチ（10問/バッチ）
  → 実行: Worker3
```

**合計: 30バッチ**

---

### ステップ 2: 各バッチの修正フロー（テンプレート）

#### 入力
```
- 問題10-20個のJSONオブジェクト
- 現在の legal_reference.article（誤った値）
```

#### 処理
```
【処理1】問題文の内容分析
  1. problem_text を読む
  2. キーワード抽出
  3. 問題が何について述べているのか把握

【処理2】正しい条文を判定
  方法A: キーワード照合
    例: 「型式検定」→ 第15条
    例: 「景品」→ 第22条
    例: 「改造」→ 第26条

  方法B: セクション名から逆引き
    例: 「景品の種類制限」→ 第22条

  方法C: RAG確認（必要に応じて）
    例: 第15条の実内容を確認して一致

【処理3】問題内容の評価
  - 問題文が条文の内容と適切か判定
  - 不適切な場合 → 問題文自体を修正

【処理4】修正を実装
  JSON の legal_reference を修正:
  ```json
  {
    "law": "風営法",
    "article": "正しい条文",
    "section": "正しいセクション",
    "detail": "詳細説明（必要に応じて）"
  }
  ```
```

#### 出力
```
- 修正済みの問題JSON（10-20個）
- 修正ログ（どの問題をどう修正したか）
```

---

### ステップ 3: 修正実行方針

**修正不可判定フロー:**
```
問題文を読む
  ↓
内容が理解できるか？
  ├─ YES → 条文判定可能 → 修正実施
  └─ NO  → データ破損の可能性
          → 【判定】削除対象もしくは【置き換え】候補
```

**複数候補がある場合:**
```
例: 「新台設置」と「中古遊技機」
  - 「設置」キーワード → 第6条の2（優先）
  - 「機の取扱い」キーワード → 別条文？
  → Worker3が最終判定
```

---

## 📋 Phase 2: 修正後の網羅性確認

### ステップ 4: 条文カバレッジ確認

**実行内容:**
```
修正後、すべての問題について：
  1. どの条文に紐付いているか確認
  2. 風営法の全条文リストと比較
  3. 出題されていない条文を抽出
```

**実装方法:**
```python
# 出題済み条文リスト
出題済み = {
  '第3条', '第4条', '第6条', '第6条の2',
  '第8条', '第9条', '第15条', '第22条',
  '第24条', '第26条', '第33条以下'
}

# 風営法全条文
全条文 = [第1条, 第2条, 第3条, ..., 第320条]

# 未出題条文
未出題 = 全条文 - 出題済み
```

**出力:**
```
- 出題済み条文一覧（問題数付き）
- 未出題条文リスト
- 網羅率 (%)
```

---

## 👥 作業分担

### Worker3（Claude Code = 私）
- **担当**: 第6条（383問）、第26条（45問）、第6条の2（20問）
- **バッチ数**: 26バッチ
- **処理順序**: 第6条 → 第6条の2 → 第26条
- **時間**: 約13-26時間（バッチ間隔含む）

### Worker2
- **担当**: 第4条（8問）、第8条（18問）、第9条（6問）
- **バッチ数**: 4バッチ
- **処理順序**: 第4条 → 第9条 → 第8条
- **時間**: 約2-4時間

### Got（GPT-5）
- **ステータス**: 待機
- **用途**: 修正内容の最終確認（必要に応じて）

---

## 📁 保存・管理

### 修正前後の比較
```
修正前: /home/planj/patshinko-exam-app/data/PROBLEMS_FINAL_1491.json
修正後: /home/planj/patshinko-exam-app/data/PROBLEMS_CORRECTED_480_YYYYMMDD.json
バックアップ: /home/planj/patshinko-exam-app/backups/PROBLEMS_BACKUP_BEFORE_480_CORRECTION.json
```

### 修正ログ
```
/home/planj/patshinko-exam-app/CORRECTION_LOG_480PROBLEMS.json

フォーマット:
[
  {
    "problem_id": 13,
    "before_article": "第6条の2",
    "after_article": "正しい条文",
    "before_section": "（遊技機の設置）",
    "after_section": "正しいセクション",
    "problem_text": "...",
    "reason": "修正理由",
    "batch": 1,
    "worker": "Worker3"
  },
  ...
]
```

---

## ✅ チェックリスト

修正実行前：
- [ ] このドキュメント（フロー計画）が明確化されている
- [ ] Worker2へ作業分担が伝達される
- [ ] バックアップが取得済み

修正実行後（Phase 2）：
- [ ] 480問すべての修正が完了
- [ ] 修正ログが記録される
- [ ] 条文カバレッジが確認される
- [ ] 未出題条文が特定される

---

## 🚀 実行開始条件

```
✅ 準備完了チェック
  ├─ フロー計画: このドキュメント
  ├─ Worker2への通知: 実施予定
  ├─ バックアップ: 実施予定
  └─ ドキュメント保存: このファイル

実行開始: 上記チェック完了後
```

---

**次: Phase 1 実行開始（条文別グループ化 + バッチ修正）**

