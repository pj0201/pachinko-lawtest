# Week 7 実行ガイド（品質最優先版）

**目的**: 品質スコア 0.73点 → 0.80点以上の達成
**重点**: ディストラクタ強度とひっかけ度制御

---

## ⚠️ **事前準備（Week 7開始前に必ず実行）**

### **Step 0: 品質改善ガイド確認**

```bash
# 必ず以下を参照:
$ cat QUALITY_IMPROVEMENT_GUIDE.md

重点確認事項:
  1. ディストラクタ品質の4構造
  2. テンプレート別ひっかけ度目標値
  3. Claude APIプロンプト強化版
```

### **Step 1: テスト生成（試験実行）**

```bash
# 実施期間: Week 7開始1日目
# 目的: 改善版プロンプトで実際の品質向上を確認

# T1, T2, T3, T4, T5 から各1問ずつ、計5問を試験生成

ファイル出力: output/technology_domain_test_5problems.json
```

---

## 🎯 **改善版Claude APIプロンプト**

### **システムプロンプト（共通）**

```
あなたは「遊技機取扱主任者試験」の高品質な問題生成AI です。

【重要】複合語46個の絶対保持:
複合語は絶対に分割・変更してはいけません。
[複合語リスト: 営業許可, 型式検定, 営業禁止, ...]

【ディストラクタ（選択肢）の品質基準】

この指示を完全に守ってください。ディストラクタの品質が、
問題の品質スコアの約30%を占めます。

正答(A): 100% 正しい（根拠: 条文・教材から明確に導ける）
選択肢B: 学習者の典型的な誤り
  - 特徴: 似た用語の誤解（例: 型式検定と営業許可の混同）
  - 正答率: 40-60%の学習者が選ぶほどの説得力
選択肢C: 関連するが異なる概念
  - 特徴: テーマに関連するが別の規定
  - 正答率: 20-30%の学習者が選ぶ
選択肢D: 微妙な誤り
  - 特徴: 一部は正しいが条件や範囲が異なる
  - 正答率: 5-20%の学習者のみが選ぶ（上級者向け）

【ひっかけ度制御】

テンプレート別に、正答の選択率を以下に制御してください：

T1: 正答選択率 85% （ひっかけ度 15%）
T2: 正答選択率 65% （ひっかけ度 35%）
T3: 正答選択率 55% （ひっかけ度 45%）
T4: 正答選択率 65% （ひっかけ度 35%）
T5: 正答選択率 55% （ひっかけ度 45%）
```

### **テンプレート別ユーザープロンプト**

#### **T1 (基本知識)**

```
技術管理分野のT1 (基本知識)テンプレートで、難易度「基礎」の問題を生成してください。

【重要な指示】
- ひっかけ度: 10-20%の範囲内（正答選択率 80-90%）
- 大多数の学習者が正答を選べる明確な問題にしてください
- 選択肢B: 学習者の典型的な誤り（似た概念との混同）

【チャンクコンテキスト】
[実際のチャンク内容]

【出力形式】
{
  "problem_id": "technology_T1_XXX",
  "domain": "technology",
  "template": "T1",
  "difficulty": "基礎",
  "question": "...",
  "options": {
    "A": "... (確実に正しい)",
    "B": "... (典型的な誤り)",
    "C": "... (関連するが異なる)",
    "D": "... (微妙な誤り)"
  },
  "correct_answer": "A",
  "explanation": "...",
  "source_theme": "theme_XXX",
  "compound_words_used": ["複合語"]
}
```

#### **T2 (条文直結)**

```
技術管理分野のT2 (条文直結)テンプレートで、難易度「標準」の問題を生成してください。

【重要な指示】
- ひっかけ度: 30-40%の範囲内（正答選択率 60-70%）
- 標準難易度: 正答には理由があるが、誤りも説得力あり
- 選択肢B-D: すべてに「選ばれる可能性」を持たせてください

【チャンクコンテキスト】
[実際のチャンク内容]

【出力形式】
[T1と同じ形式]
```

#### **T3 (ひっかけ)**

```
技術管理分野のT3 (ひっかけ)テンプレートで、難易度「応用」の問題を生成してください。

【重要な指示】
- ひっかけ度: 40-50%の範囲内（正答選択率 50-60%）
- 応用難易度: 4択すべてに説得力、慎重な判断が必要
- ディストラクタの品質: 正答と同等レベルの根拠を持たせてください

【品質チェックリスト】
☑ 正答は根拠が明確か（条文から導ける）
☑ 選択肢B: 学習者の典型的な誤解か（誤りが自然か）
☑ 選択肢C: 関連するが異なるか
☑ 選択肢D: 微妙な誤りか（詳しい者のみ判別可能）
☑ 4択すべてに「選ばれる可能性」があるか

【チャンクコンテキスト】
[実際のチャンク内容]

【出力形式】
[T1と同じ形式]
```

#### **T4 (複合条件)**

```
技術管理分野のT4 (複合条件)テンプレートで、難易度「標準」の問題を生成してください。

【重要な指示】
- ひっかけ度: 30-40%の範囲内（正答選択率 60-70%）
- 複数条件で混同させるが標準難易度
- 選択肢: 条件を部分的に誤った解釈を含める

【チャンクコンテキスト】
[実際のチャンク内容]

【出力形式】
[T1と同じ形式]
```

#### **T5 (実務判断)**

```
技術管理分野のT5 (実務判断)テンプレートで、難易度「応用」の問題を生成してください。

【重要な指示】
- ひっかけ度: 40-50%の範囲内（正答選択率 50-60%）
- 応用難易度: 実務知識を要する
- 選択肢: 実務で実際に起こりやすい誤りを含める

【チャンクコンテキスト】
[実際のチャンク内容]

【出力形式】
[T1と同じ形式]
```

---

## 📋 **実行手順（Week 7本生成）**

### **Phase 1: テスト生成（1日）**

```bash
# Day 1 午前: テスト5問生成
  1. T1から1問
  2. T2から1問
  3. T3から1問
  4. T4から1問
  5. T5から1問

出力: output/technology_domain_test_5problems.json

# Day 1 午後: 品質評価
  1. 各問題の「ディストラクタ品質」を確認
  2. ひっかけ度がテンプレート別範囲内か確認
  3. 複合語が正確に使用されているか確認

ツール: QUALITY_IMPROVEMENT_GUIDE.md の品質チェックリスト
```

### **Phase 2: 調整・最適化（1日）**

```bash
# Day 2 午前: テスト結果分析
  - プロンプトの効果を測定
  - 必要な調整を特定

# Day 2 午後: プロンプト最適化
  - 必要に応じてプロンプトを調整
  - 温度（temperature）パラメータの設定確認
  - 再度5問で確認

出力: output/technology_domain_test_5problems_v2.json (必要な場合)
```

### **Phase 3: 本生成（3-4日）**

```bash
# Day 3-4: 本生成50問

# T1 (基本知識) 10問生成
  - テンプレート: T1を使用
  - ひっかけ度: 10-20%範囲内
  - 時間: 約20分（API呼び出し）

# T2 (条文直結) 10問生成
  - テンプレート: T2を使用
  - ひっかけ度: 30-40%範囲内
  - 時間: 約20分

# T3 (ひっかけ) 10問生成
  - テンプレート: T3を使用
  - ひっかけ度: 40-50%範囲内
  - 時間: 約20分

# T4 (複合条件) 10問生成
  - テンプレート: T4を使用
  - ひっかけ度: 30-40%範囲内
  - 時間: 約20分

# T5 (実務判断) 10問生成
  - テンプレート: T5を使用
  - ひっかけ度: 40-50%範囲内
  - 時間: 約20分

出力: output/technology_domain_50_raw.json
```

### **Phase 4: 検証・品質評価（1日）**

```bash
# Day 5: 複合語検証
$ python3 backend/validate_week6_150_problems.py

成功基準:
  ☑ 複合語検証合格率: ≥95%（47問以上）
  ☑ 複合語カバー率: ≥80%（36個以上）
  ☑ 重大エラー: 0件

# Day 5: 品質メトリクス計算
$ python3 backend/integrate_week6_quality_metrics.py

成功基準:
  ☑ 品質スコア: ≥0.80点（優秀）
  ☑ ディストラクタ: ≥0.80点
  ☑ ひっかけ度: ≥0.70点
```

### **Phase 5: Gitコミット（1日）**

```bash
git add output/technology_domain_50_raw.json
git commit -m "feat: Week 7 Task 7.1 - 技術管理分野50問本生成完了（品質改善版）"
```

---

## ✅ **品質目標値**

### **Week 7終了時の期待値**

```
【技術管理分野50問】
- 複合語検証: ≥95%合格
- 総合品質スコア: 0.80点以上（優秀）
  ├─ 明確性: 0.79点以上
  ├─ ディストラクタ: 0.80点以上 ★ TARGET
  ├─ 根拠性: 0.88点以上
  └─ ひっかけ度: 0.70点以上 ★ TARGET
```

---

## 🚀 **全体スケジュール**

```
Day 1: テスト生成 + 品質評価
Day 2: 調整・最適化
Day 3-4: 本生成50問
Day 5: 検証・品質評価
Day 6: コミット

→ 次: Week 8 セキュリティ分野50問（同様プロセス）
→ 次: Week 9 営業規制分野50問（同様プロセス）
→ 次: Week 10 150問統合評価
```

---

**品質最優先で実行してください！**

