#!/usr/bin/env python3
"""
éŠæŠ€æ©Ÿå–æ‰±ä¸»ä»»è€…è©¦é¨“å•é¡Œç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ  v2.5 ENHANCED
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤§å¹…å¼·åŒ–ç‰ˆ
Version: 2.5 ENHANCED
Date: 2025-11-02
"""

import json
import random
from datetime import datetime
from typing import Dict, List, Optional

class EnhancedProblemsGenerator:
    """ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤§å¹…å¼·åŒ–ç‰ˆ"""

    def __init__(self):
        """åˆæœŸåŒ–"""
        self.categories = self._initialize_categories()
        self.patterns = self._initialize_patterns()
        self.problem_templates = self._initialize_enhanced_templates()
        self.problem_id_counter = 1
        self.problems = []
        self.generated_texts = set()

    def _initialize_categories(self) -> Dict:
        """ã‚«ãƒ†ã‚´ãƒªã‚’åˆæœŸåŒ–"""
        return {
            "å–¶æ¥­è¨±å¯": {"id": 1000, "articles": "ç¬¬3æ¡ã€œç¬¬8æ¡"},
            "å–¶æ¥­æ‰€åŸºæº–": {"id": 2000, "articles": "ç¬¬9æ¡ã€œç¬¬10æ¡"},
            "éŠæŠ€æ©Ÿã®è¨­ç½®": {"id": 3000, "articles": "ç¬¬11æ¡ã€œç¬¬15æ¡"},
            "éŠæŠ€æ©Ÿã®èªå®š": {"id": 4000, "articles": "ç¬¬16æ¡ã€œç¬¬20æ¡"},
            "æ™¯å“è¦åˆ¶": {"id": 5000, "articles": "ç¬¬21æ¡ã€œç¬¬25æ¡"},
            "å–¶æ¥­æ™‚é–“": {"id": 6000, "articles": "ç¬¬26æ¡ã€œç¬¬30æ¡"},
            "ä¸æ­£é˜²æ­¢": {"id": 7000, "articles": "ç¬¬31æ¡ã€œç¬¬35æ¡"},
            "ç›£ç£ãƒ»æŒ‡å°": {"id": 8000, "articles": "ç¬¬36æ¡ã€œç¬¬40æ¡"},
            "è³‡æ ¼è¦ä»¶": {"id": 9000, "articles": "ç¬¬41æ¡ã€œç¬¬45æ¡"},
            "æ³•æ”¹æ­£": {"id": 10000, "articles": "æœ€æ–°æ”¹æ­£äº‹é …"}
        }

    def _initialize_patterns(self) -> Dict:
        """12ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆæœŸåŒ–"""
        return {
            1: {"name": "åŸºæœ¬çŸ¥è­˜", "difficulty": "â˜…", "weight": 0.15},
            2: {"name": "ã²ã£ã‹ã‘", "difficulty": "â˜…â˜…", "weight": 0.30},
            3: {"name": "ç”¨èªæ¯”è¼ƒ", "difficulty": "â˜…â˜…", "weight": 0.10},
            4: {"name": "å„ªå…ˆé †ä½", "difficulty": "â˜…â˜…", "weight": 0.08},
            5: {"name": "æ™‚ç³»åˆ—ç†è§£", "difficulty": "â˜…â˜…â˜…", "weight": 0.10},
            6: {"name": "ã‚·ãƒŠãƒªã‚ªåˆ¤å®š", "difficulty": "â˜…â˜…â˜…", "weight": 0.10},
            7: {"name": "è¤‡åˆé•å", "difficulty": "â˜…â˜…â˜…", "weight": 0.05},
            8: {"name": "æ•°å€¤æ­£ç¢ºæ€§", "difficulty": "â˜…", "weight": 0.05},
            9: {"name": "ç†ç”±ç†è§£", "difficulty": "â˜…â˜…â˜…", "weight": 0.03},
            10: {"name": "çµŒé¨“é™¥é˜±", "difficulty": "â˜…â˜…â˜…", "weight": 0.02},
            11: {"name": "æ”¹æ­£å¯¾å¿œ", "difficulty": "â˜…â˜…â˜…", "weight": 0.01},
            12: {"name": "è¤‡åˆå¿œç”¨", "difficulty": "â˜…â˜…â˜…â˜…", "weight": 0.01}
        }

    def _initialize_enhanced_templates(self) -> Dict:
        """å¤§å¹…ã«å¼·åŒ–ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©"""
        return {
            1: {  # åŸºæœ¬çŸ¥è­˜
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯ã¯éƒ½é“åºœçœŒå…¬å®‰å§”å“¡ä¼šã‹ã‚‰å—ã‘ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯3å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯5å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯å–¶æ¥­æ‰€å†…ã«æ²ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯æœªæˆå¹´è€…ã«ã¯ä»˜ä¸ã•ã‚Œãªã„ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯ç¦æ²»ç”£è€…ã«ã¯ä»˜ä¸ã•ã‚Œãªã„ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€åŸºæº–ã‚’æº€ãŸã™åœ°åŸŸã§ã®å–¶æ¥­è¨±å¯ç”³è«‹ã¯å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯ç›¸ç¶šã«ã‚ˆã‚Šæ‰¿ç¶™ã§ãã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«å–¶æ¥­è¨ˆç”»æ›¸ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«é…ç½®å›³ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯é•åãŒç¶šãå ´åˆã«å–ã‚Šæ¶ˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã®æ§‹é€ ãƒ»è¨­å‚™ã¯æ³•å®šåŸºæº–ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¨±å¯å–å¾—å¾Œã®å–¶æ¥­è€…å¤‰æ›´ã¯å±Šå‡ºãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¨±å¯å–å¾—å¾Œã®æ–½è¨­å¤‰æ›´ã¯å±Šå‡ºãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¯å–¶æ¥­é–‹å§‹ã®30æ—¥å‰ã‹ã‚‰å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¯å–¶æ¥­é–‹å§‹ã®60æ—¥å‰ã‹ã‚‰å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æ›´æ–°æ‰‹ç¶šãã¯æœ‰åŠ¹æœŸé™å†…ã«ç”³è«‹ã™ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯ä¸»ä»»è€…è³‡æ ¼ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯æ–½è¨­è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯è­²æ¸¡ã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯è»¢è²¸ã™ã‚‹ã“ã¨ãŒã§ããªã„ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­ç¦æ­¢åŒºåŸŸã§ã®å–¶æ¥­è¨±å¯ç”³è«‹ã¯å—ç†ã•ã‚Œãªã„ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è€…ãŒå¤‰æ›´ã•ã‚Œã‚‹å ´åˆã¯æ–°è¦è¨±å¯ç”³è«‹ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯ä½æ°‘ç¥¨ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯èº«åˆ†è¨¼æ˜æ›¸ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã®æœ€å°é¢ç©ã¯æ³•ä»¤ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé–“ä¸­ã¯å®šæœŸå ±å‘ŠãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯åŒä¸€äººç‰©ãŒè¤‡æ•°ã®å–¶æ¥­æ‰€ã§å–å¾—å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯åŒä¸€äººç‰©ãŒè¤‡æ•°ã®å–¶æ¥­æ‰€ã§ç”³è«‹å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®ç”³è«‹ã¯é¢¨å–¶æ³•ç¬¬3æ¡ã«åŸºã¥ãã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®ç”³è«‹ã«ã¯å…¬å®‰å§”å“¡ä¼šã¸ã®å±Šå‡ºãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã®æ‰‹æ•°æ–™ã¯æ³•ä»¤ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã®æ‰‹ç¶šãã¯æ¨™æº–åŒ–ã•ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯å–å¾—è€…ã¯å®šæœŸçš„ã«æ–½è¨­æ¤œæŸ»ã‚’å—ã‘ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯å–å¾—è€…ã¯å¸³ç°¿è¨˜éŒ²ç¾©å‹™ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯å–å¾—è€…ã¯å–¶æ¥­å ±å‘Šæ›¸ã‚’æå‡ºã™ã‚‹ç¾©å‹™ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã®å–¶æ¥­ç’°å¢ƒã¯é©åˆ‡ã«ç¶­æŒã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯å–¶æ¥­ã®ç›®çš„ãŒæ˜è¨˜ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«ã¯å–¶æ¥­æ‰€ã®è©³ç´°ãªä½ç½®è¨˜è¼‰ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™æº€äº†å‰ã«ã¯æ›´æ–°æ‰‹ç¶šããŒå¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ],
                "éŠæŠ€æ©Ÿã®èªå®š": [
                    {"text": "éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´ã”ã¨ã«æ›´æ–°ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯5å¹´ã”ã¨ã«æ›´æ–°ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šåˆæ ¼æ©Ÿã¯å‹å¼æ¤œå®šæ¨™ç¥¨ã‚’è¡¨ç¤ºã™ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "ä¸­å¤éŠæŠ€æ©Ÿã®è¨­ç½®ã«ã¯å‹å¼æ¤œå®šåˆæ ¼ãŒå¿…é ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šã®ç”³è«‹ã¯éƒ½é“åºœçœŒã«è¡Œã†ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šã®ç”³è«‹ã¯æŒ‡å®šæ¤œæŸ»æ©Ÿé–¢ã«è¡Œã†ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ã¯æœ‰åŠ¹æœŸé™ã®30æ—¥å‰ã‹ã‚‰å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ã¯æœ‰åŠ¹æœŸé™ã®90æ—¥å‰ã‹ã‚‰å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ],
                "æ™¯å“è¦åˆ¶": [
                    {"text": "æ™¯å“ã®ç¨®é¡ã¨é‡‘é¡ã¯æ³•å¾‹ã§å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ™¯å“ã®æœ€é«˜é¡ã¯10000å††ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ™¯å“ã®æœ€é«˜é¡ã¯20000å††ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ™¯å“ã®æœ€é«˜é¡ã¯50000å††ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ],
                "å–¶æ¥­æ™‚é–“": [
                    {"text": "å–¶æ¥­ç¦æ­¢æ™‚é–“å¸¯ã«ãŠã‘ã‚‹å–¶æ¥­ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ™‚é–“ã®åˆ¶é™ã¯é’å°‘å¹´ä¿è­·ã®ãŸã‚ã«è¨­ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ™‚é–“ã®åˆ¶é™ã¯ç¤¾ä¼šç§©åºç¶­æŒã®ãŸã‚ã«è¨­ã‘ã‚‰ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"}
                ],
                "ä¸æ­£é˜²æ­¢": [
                    {"text": "éŠæŠ€æ©Ÿã®ä¸æ­£æ”¹é€ ã¯å³ã—ãç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "éŠæŠ€æ©Ÿã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯å‹å¼æ¤œå®šã§ç¢ºä¿ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "éŠæŠ€æ©Ÿã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯æ–½éŒ æ©Ÿæ§‹ã§ç¢ºä¿ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            2: {  # ã²ã£ã‹ã‘
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯ã¯é•åã®å ´åˆã€å¿…ãšå–ã‚Šæ¶ˆã•ã‚Œã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¯èª°ã§ã‚‚è‡ªç”±ã«ã§ãã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¯èª°ã§ã‚‚ã„ã¤ã§ã‚‚ã§ãã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯çµ¶å¯¾ã«ç„¡æœŸé™ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯å¸¸ã«ç„¡æœŸé™ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­æ‰€ã®æ§‹é€ ã¯å³å¯†ã«åŸºæº–ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è€…ã®å¤‰æ›´ã¯çµ¶å¯¾ã«å±Šå‡ºãŒå¿…é ˆã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è€…ã®å¤‰æ›´ã¯å¿…ãšå±Šå‡ºãŒå¿…é ˆã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯çµ¶å¯¾ã«è­²æ¸¡ã§ããªã„ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯æ±ºã—ã¦è­²æ¸¡ã§ããªã„ã€‚", "answer": "Ã—"},
                    {"text": "è¨±å¯ç”³è«‹æ›¸ã®è¨˜è¼‰äº‹é …ã¯å³æ ¼ã«å¤‰æ›´ä¸å¯ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯ç‰¹å®šã®ä¸å‹•ç”£ã®ã¿ã§æœ‰åŠ¹ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯çµ¶å¯¾3å¹´ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯çµ¶å¯¾5å¹´ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­åœæ­¢å‘½ä»¤ã¯å¿…ãšå–¶æ¥­å»ƒæ­¢ã«è‡³ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­åœæ­¢å‘½ä»¤ã¯çµ¶å¯¾ã«å–¶æ¥­å»ƒæ­¢ã«è‡³ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šåˆæ ¼æ©Ÿã¯å¿…ãšå–¶åˆ©ã«ä½¿ç”¨ã§ãã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "ä¸­å¤æ©Ÿã®æ¤œå®šã¯æ–°å°ã¨åŒä¸€åŸºæº–ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šã¯ä¸€åº¦åˆæ ¼ã™ã‚Œã°æ°¸é ã«æœ‰åŠ¹ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šç”³è«‹ã¯ã©ã‚“ãªéŠæŠ€æ©Ÿã§ã‚‚å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "æ™¯å“ã¯å…¨ã¦ã®ç¨®é¡ãŒæ”¯çµ¦å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "æ™¯å“é¡ã¯å³æ ¼ã«åˆ¶é™ã•ã‚Œãªã„ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ã¯ç”³è«‹è€…å…¨å“¡ã«ä»˜ä¸ã•ã‚Œã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­æ‰€ã®ä½ç½®å¤‰æ›´ã¯ç„¡æ–­ã§å®Ÿæ–½ã—ãŸå ´åˆã€è‡ªå‹•çš„ã«å–ã‚Šæ¶ˆã•ã‚Œã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã«å¿…è¦ãªæ›¸é¡ã¯çµ¶å¯¾ã«å¤‰ã‚ã‚‰ãªã„ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šæ›´æ–°ã¯ä¸€åº¦ã‚‚å»¶æœŸã§ããªã„ã€‚", "answer": "Ã—"},
                    {"text": "æ™¯å“è¦åˆ¶é•åã¯ã©ã®ã‚ˆã†ãªå ´åˆã§ã‚‚åŒä¸€ç½°å‰‡ã§ã‚ã‚‹ã€‚", "answer": "Ã—"}
                ],
                "éŠæŠ€æ©Ÿã®èªå®š": [
                    {"text": "å‹å¼æ¤œå®šç”³è«‹ã¯å…¨ã¦ã®éŠæŠ€æ©Ÿã§å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å‹å¼æ¤œå®šæ¨™ç¥¨ã¯çµ¶å¯¾ã«å¤‰æ›´ã§ããªã„ã€‚", "answer": "Ã—"},
                    {"text": "ä¸­å¤æ©Ÿã¯æ–°å°ã¨åŒã˜æ¤œå®šåŸºæº–ã§åˆæ ¼ã™ã‚‹ã€‚", "answer": "Ã—"}
                ],
                "æ™¯å“è¦åˆ¶": [
                    {"text": "æ™¯å“æ”¯çµ¦ã¯ä½•åº¦ã§ã‚‚ä¸Šé™é‡‘é¡ã¾ã§æ”¯çµ¦å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "Ã—"},
                    {"text": "å…¨ã¦ã®æ™¯å“ç¨®é¡ãŒæ”¯çµ¦å¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "Ã—"}
                ]
            },
            3: {  # ç”¨èªæ¯”è¼ƒ
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã¯ç•°ãªã‚‹æœ‰åŠ¹æœŸé™ã‚’æŒã¤ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨èªå®šæ©Ÿé–¢ã®æŒ‡å®šã¯ç•°ãªã‚‹æœ‰åŠ¹æœŸé™ã‚’æŒã¤ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šã¯å–¶æ¥­è¨±å¯ã¨ç•°ãªã‚Šã€æ›´æ–°ç”³è«‹ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨æ™¯å“è¦åˆ¶ã¯ç•°ãªã‚‹æ³•ä»¤ã§ç®¡ç†ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨æ™¯å“è¦åˆ¶ã¯ç•°ãªã‚‹æœŸé™ã§ç®¡ç†ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨æ™¯å“è¦åˆ¶ã¯ç•°ãªã‚‹æ¡æ–‡ã§ç®¡ç†ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "ç”²çœŒã§ã®å–¶æ¥­è¨±å¯ã¯ä¹™çœŒã§ã®è¨±å¯ã¨ç•°ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¨æ›´æ–°ç”³è«‹ã¯å¿…è¦æ›¸é¡ãŒç•°ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ç”³è«‹ã¨æ›´æ–°ç”³è«‹ã¯æ‰‹æ•°æ–™ãŒç•°ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­åœæ­¢å‘½ä»¤ã¨å–¶æ¥­å»ƒæ­¢ã¯ç›®çš„ãŒç•°ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­åœæ­¢å‘½ä»¤ã¨å–¶æ¥­å»ƒæ­¢ã¯æœŸé–“ãŒç•°ãªã‚‹ã€‚", "answer": "â—‹"}
                ],
                "æ™¯å“è¦åˆ¶": [
                    {"text": "æ™¯å“ã®æœ€é«˜é¡ã¨å–¶æ¥­æ‰€ã®ä½ç½®ã¯ç•°ãªã‚‹åŸºæº–ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "é‡‘éŠ­æ™¯å“ã¨ç‰©å“æ™¯å“ã®æ”¯çµ¦é¡ä¸Šé™ã¯ç•°ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "é‡‘éŠ­æ™¯å“ã¨æœ‰ä¾¡è¨¼åˆ¸ã®æ”¯çµ¦é¡ä¸Šé™ã¯ç•°ãªã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            4: {  # å„ªå…ˆé †ä½
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã®ç”³è«‹é †åºã¯è¨±å¯ãŒå…ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨å–¶æ¥­æ‰€åŸºæº–ç¢ºèªã®é †åºã¯åŸºæº–ç¢ºèªãŒå…ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã®ç”³è«‹é †åºã¯æ¤œå®šãŒå…ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            5: {  # æ™‚ç³»åˆ—ç†è§£
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­é–‹å§‹ã‹ã‚‰3å¹´å¾Œã«è¨±å¯æ›´æ–°ç”³è«‹ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­é–‹å§‹ã‹ã‚‰5å¹´å¾Œã«è¨±å¯æ›´æ–°ç”³è«‹ãŒå¿…è¦ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šåˆæ ¼ã‹ã‚‰3å¹´ã§æ›´æ–°ç”³è«‹ã®å¯¾è±¡ã¨ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šåˆæ ¼ã‹ã‚‰5å¹´ã§æ›´æ–°ç”³è«‹ã®å¯¾è±¡ã¨ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¨±å¯ç”³è«‹ã‹ã‚‰è¨±å¯äº¤ä»˜ã¾ã§ã¯é€šå¸¸30æ—¥ç¨‹åº¦ã‚’è¦ã™ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¨±å¯ç”³è«‹ã‹ã‚‰è¨±å¯äº¤ä»˜ã¾ã§ã¯é€šå¸¸60æ—¥ç¨‹åº¦ã‚’è¦ã™ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¨±å¯ç”³è«‹ã‹ã‚‰è¨±å¯äº¤ä»˜ã¾ã§ã¯é€šå¸¸90æ—¥ç¨‹åº¦ã‚’è¦ã™ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã®å¤‰æ›´å±Šã¯å®Ÿæ–½å‰ã«æå‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã®å¤‰æ›´å±Šã¯å¤‰æ›´å¾Œã«æå‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ã¯æœ‰åŠ¹æœŸé™ã®30æ—¥å‰ã‹ã‚‰å—ä»˜ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ã¯æœ‰åŠ¹æœŸé™ã®60æ—¥å‰ã‹ã‚‰å—ä»˜ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            6: {  # ã‚·ãƒŠãƒªã‚ªåˆ¤å®š
                "å–¶æ¥­è¨±å¯": [
                    {"text": "AãŒå–¶æ¥­è¨±å¯ã‚’å–å¾—ã—å–¶æ¥­æ‰€ä½ç½®ã‚’å¤‰æ›´ã—ãŸãŒå±Šå‡ºã—ã¦ã„ãªã„å ´åˆã€ä¸æ­£å–¶æ¥­ã«ãªã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "BãŒè¨±å¯æœŸé–“ä¸­ã«é•åè¡Œç‚ºã‚’ã—ã¦å–¶æ¥­åœæ­¢å‘½ä»¤ã‚’å—ã‘ãŸå ´åˆã€å–¶æ¥­å†é–‹ã«ã¯æ–°è¨±å¯ç”³è«‹ãŒå¿…è¦ã€‚", "answer": "â—‹"},
                    {"text": "CãŒå‹å¼æ¤œå®šæœŸé–“ä¸­ã«æ©Ÿæ¢°ã‚’ç„¡æ–­æ”¹é€ ã—ãŸå ´åˆã€èªå®šãŒå–ã‚Šæ¶ˆã•ã‚Œã‚‹ã€‚", "answer": "â—‹"}
                ],
                "æ™¯å“è¦åˆ¶": [
                    {"text": "DãŒæ³•å®šä¸Šé™ã‚’è¶…ãˆã‚‹æ™¯å“ã‚’æ”¯çµ¦ã—ãŸå ´åˆã€ç½°é‡‘ã«å‡¦ã›ã‚‰ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "DãŒæ³•å®šä¸Šé™ã‚’è¶…ãˆã‚‹æ™¯å“ã‚’æ”¯çµ¦ã—ãŸå ´åˆã€å–¶æ¥­åœæ­¢ãŒã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            7: {  # è¤‡åˆé•å
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯é•åã¨å‹å¼æ¤œå®šé•åã‚’åŒæ™‚ã«çŠ¯ã—ãŸå ´åˆã€ã‚ˆã‚Šé‡ã„ç½°å‰‡ãŒé©ç”¨ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯é•åã¨æ™¯å“è¦åˆ¶é•åã‚’åŒæ™‚ã«çŠ¯ã—ãŸå ´åˆã€ã‚ˆã‚Šé‡ã„ç½°å‰‡ãŒé©ç”¨ã•ã‚Œã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¤‡æ•°ã®è¦åˆ¶é•åãŒã‚ã‚‹å ´åˆã€å–¶æ¥­è¨±å¯å–ã‚Šæ¶ˆã—ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "è¤‡æ•°ã®è¦åˆ¶é•åãŒã‚ã‚‹å ´åˆã€å–¶æ¥­åœæ­¢ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            8: {  # æ•°å€¤æ­£ç¢ºæ€§
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯æ­£ç¢ºã«3å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯æ­£ç¢ºã«5å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯3å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯5å¹´ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã¯å­¦æ ¡ã‹ã‚‰æœ€ä½100mä»¥ä¸Šé›¢ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã¯å­¦æ ¡ã‹ã‚‰æœ€ä½200mä»¥ä¸Šé›¢ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ã¯å­¦æ ¡ã‹ã‚‰æœ€ä½500mä»¥ä¸Šé›¢ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ™¯å“ã®æœ€é«˜æ”¯çµ¦é¡ã¯10000å††ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ™¯å“ã®æœ€é«˜æ”¯çµ¦é¡ã¯20000å††ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            9: {  # ç†ç”±ç†è§£
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­æ‰€åŸºæº–ãŒå³æ ¼ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã¯åˆ©ç”¨å®¢ä¿è­·ã®ãŸã‚ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€åŸºæº–ãŒå³æ ¼ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã®ã¯ä¸æ­£é˜²æ­¢ã®ãŸã‚ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å‹å¼æ¤œå®šãŒå¿…é ˆã¨ã•ã‚Œã‚‹ã®ã¯æ©Ÿæ¢°ã®å®‰å…¨ç¢ºä¿ã®ãŸã‚ã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            10: {  # çµŒé¨“é™¥é˜±
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å®Ÿå‹™ã§ã¯å–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã®æ›´æ–°ã¯åŒæ™‚ã«è¡Œã†å ´åˆãŒå¤šã„ãŒã€æ³•åˆ¶ä¸Šã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ãŒå®Ÿéš›ã«ç¨¼åƒã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯é€²è¡Œä¸­ã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "å–¶æ¥­æ‰€ãŒå®Ÿéš›ã«ç¨¼åƒã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€è¨±å¯ã®æœ‰åŠ¹æœŸé™ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã€‚", "answer": "â—‹"}
                ]
            },
            11: {  # æ”¹æ­£å¯¾å¿œ
                "å–¶æ¥­è¨±å¯": [
                    {"text": "2020å¹´ã®æ”¹æ­£ã«ã‚ˆã‚Šã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç”³è«‹ãŒæ–°ãŸã«å°å…¥ã•ã‚ŒãŸã€‚", "answer": "â—‹"},
                    {"text": "2020å¹´ã®æ”¹æ­£ã«ã‚ˆã‚ŠæœŸé™å»¶é•·åˆ¶åº¦ãŒæ–°ãŸã«å°å…¥ã•ã‚ŒãŸã€‚", "answer": "â—‹"},
                    {"text": "æœ€è¿‘ã®æ³•æ”¹æ­£ã§ç”³è«‹æ›¸é¡ã®è¦å®šãŒç·©å’Œã•ã‚ŒãŸã€‚", "answer": "â—‹"}
                ]
            },
            12: {  # è¤‡åˆå¿œç”¨
                "å–¶æ¥­è¨±å¯": [
                    {"text": "å–¶æ¥­è¨±å¯å–å¾—å¾Œã€å–¶æ¥­æ‰€å¤‰æ›´â†’å‹å¼æ¤œå®šæ›´æ–°â†’æ™¯å“è¦åˆ¶éµå®ˆã®æµã‚Œã§ã€æœ€åˆã«å¯¾å¿œã™ã¹ãã¯å–¶æ¥­è¨±å¯ã®å¤‰æ›´å±Šã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ–°åº—èˆ—é–‹è¨­æ™‚ã¯å–¶æ¥­è¨±å¯ç”³è«‹ãŒå–¶æ¥­æ‰€è¨­å–¶ã‚ˆã‚Šå…ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"},
                    {"text": "æ–°åº—èˆ—é–‹è¨­æ™‚ã¯å–¶æ¥­è¨±å¯ç”³è«‹ãŒæ©Ÿæ¢°å°å…¥ã‚ˆã‚Šå…ˆã§ã‚ã‚‹ã€‚", "answer": "â—‹"}
                ]
            }
        }

    def generate_problems(self, target_count: int = 500) -> List[Dict]:
        """ç›®æ¨™æ•°ã®å•é¡Œã‚’ç”Ÿæˆ"""
        print(f"ğŸ¯ {target_count}å•ã®å•é¡Œã‚’å¼·åŒ–ç‰ˆã§ç”Ÿæˆé–‹å§‹...")

        pattern_distribution = {}
        for pattern_id, pattern in self.patterns.items():
            count = int(target_count * pattern["weight"])
            pattern_distribution[pattern_id] = count

        category_list = list(self.categories.keys())
        category_count = len(category_list)

        for pattern_id in sorted(self.patterns.keys()):
            pattern_name = self.patterns[pattern_id]["name"]
            total_for_pattern = pattern_distribution[pattern_id]

            for i in range(total_for_pattern):
                category = category_list[i % category_count]

                # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—
                templates = self.problem_templates.get(pattern_id, {}).get(category, [])
                if not templates:
                    for alt_category in category_list:
                        alt_templates = self.problem_templates.get(pattern_id, {}).get(alt_category, [])
                        if alt_templates:
                            templates = alt_templates
                            break

                if templates:
                    template = random.choice(templates)

                    problem = {
                        'problem_id': self.problem_id_counter,
                        'pattern_id': pattern_id,
                        'pattern_name': pattern_name,
                        'category': category,
                        'difficulty': self.patterns[pattern_id]['difficulty'],
                        'problem_type': 'true_false',
                        'format': 'â—‹Ã—',
                        'problem_text': template['text'],
                        'correct_answer': template['answer'],
                        'explanation': template.get('explanation', f"{category}ã«é–¢ã™ã‚‹{pattern_name}å•é¡Œã§ã™ã€‚"),
                        'generated_at': datetime.now().isoformat()
                    }

                    if problem['problem_text'] not in self.generated_texts:
                        self.problems.append(problem)
                        self.generated_texts.add(problem['problem_text'])

                    self.problem_id_counter += 1

        print(f"âœ… ç”Ÿæˆå®Œäº†: {len(self.problems)}å•ï¼ˆé‡è¤‡æ’é™¤æ¸ˆã¿ï¼‰")
        return self.problems

    def save_problems(self, output_file: str):
        """å•é¡Œã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜"""
        with open(output_file, 'w', encoding='utf-8') as f:
            json.dump(self.problems, f, ensure_ascii=False, indent=2)
        print(f"ğŸ“ ä¿å­˜å®Œäº†: {output_file}")
        print(f"ğŸ“Š çµ±è¨ˆ: åˆè¨ˆ {len(self.problems)} å•")

if __name__ == "__main__":
    generator = EnhancedProblemsGenerator()
    problems = generator.generate_problems(target_count=500)
    generator.save_problems('/home/planj/patshinko-exam-app/backend/problems_driving_logic_v2_enhanced.json')
