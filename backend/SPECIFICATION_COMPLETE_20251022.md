# 遊技機取扱主任者試験 問題生成 - 仕様書完成報告

**作成日**: 2025-10-22
**ステータス**: ✅ **仕様定義完了**

---

## 📋 完成した仕様

### 1. カテゴリ別サブトピック構造

```
合計: 1491問
カテゴリ: 7個

カテゴリ1: 営業許可・申請手続き - 213問
  ├─ 1.1: 営業許可の基本要件 (30問)
  ├─ 1.2: 申請手続き・必要書類 (30問)
  ├─ 1.3: 許可基準（構造・設備） (30問)
  ├─ 1.4: 区域制限（距離基準） (25問)
  ├─ 1.5: 許可の取消・変更 (25問)
  ├─ 1.6: 特別な許可 (20問)
  ├─ 1.7: 営業者の欠格要件 (20問)
  └─ 1.8: 管理者選任の要件 (18問)

カテゴリ2: 営業時間・営業場所 - 213問
  ├─ 2.1: 営業時間の原則 (40問)
  ├─ 2.2: 営業時間の例外 (25問)
  ├─ 2.3: 営業場所の要件 (30問)
  ├─ 2.4: 禁止地域 (35問)
  ├─ 2.5: 建物内の配置 (25問)
  ├─ 2.6: 設備基準 (28問)
  ├─ 2.7: 営業場所の変更・拡張 (15問)
  └─ 2.8: 営業場所の表示 (15問)

カテゴリ3: 遊技機規制 - 213問
  ├─ 3.1: 遊技機の型式検定 (35問)
  ├─ 3.2: 検定の要件・基準 (35問)
  ├─ 3.3: 遊技機の認定制度 (30問)
  ├─ 3.4: 遊技機の設置・交換 (30問)
  ├─ 3.5: 不正遊技機 (30問)
  ├─ 3.6: 遊技機の構造規制 (25問)
  ├─ 3.7: 遊技機の台帳管理 (20問)
  └─ 3.8: 中古遊技機の流通 (18問)

カテゴリ4: 従業者の要件・禁止事項 - 213問
  ├─ 4.1: 遊技機取扱主任者の資格 (35問)
  ├─ 4.2: 主任者の職務 (35問)
  ├─ 4.3: 販売業者の要件 (30問)
  ├─ 4.4: 従業員の禁止行為 (30問)
  ├─ 4.5: 管理者の要件 (25問)
  ├─ 4.6: 主任者証の取得・更新 (20問)
  ├─ 4.7: 主任者の勤務体制 (20問)
  └─ 4.8: 従業者の記名帳簿 (18問)

カテゴリ5: 顧客保護・規制遵守 - 213問
  ├─ 5.1: 景品の規制 (35問)
  ├─ 5.2: 景品交換所 (30問)
  ├─ 5.3: 未成年者の保護 (35問)
  ├─ 5.4: 帳簿記載義務 (25問)
  ├─ 5.5: 営業の透明性 (20問)
  ├─ 5.6: 貯玉・再プレイ (20問)
  ├─ 5.7: 客引きの禁止 (20問)
  └─ 5.8: 健全化への取組み (18問)

カテゴリ6: 法令違反と行政処分 - 160問
  ├─ 6.1: 違反行為の種類 (30問)
  ├─ 6.2: 営業停止処分 (25問)
  ├─ 6.3: 営業許可取消 (25問)
  ├─ 6.4: 罰則（刑罰） (25問)
  ├─ 6.5: 行政指導と立入検査 (20問)
  └─ 6.6: 不正防止と検定取消 (20問)

カテゴリ7: 実務的対応 - 160問
  ├─ 7.1: 遊技機の日常管理 (30問)
  ├─ 7.2: 部品交換と点検 (25問)
  ├─ 7.3: セキュリティ対策 (25問)
  ├─ 7.4: トラブル対応 (25問)
  ├─ 7.5: 廃棄台の処理 (20問)
  └─ 7.6: 記録・報告業務 (20問)
```

---

### 2. 問題ロジックパターン（Worker2設計）

**参考資料**: `/home/planj/patshinko-exam-app/backend/ultimate-problem-generator-v2.js` Line 55-78

#### 基本6パターン

```
Pattern 1: 法律に明確に書いてあることをそのまま出題
  └─ 比率: 25%（375問）
  └─ 目的: 基本知識確認

Pattern 2: 「必ず」「絶対」などの絶対表現を含めて、例外を見落とさせるひっかけ
  └─ 比率: 18%（268問）
  └─ 目的: 例外認識能力向上

Pattern 3: 似た概念だが異なる法律用語の違いを理解させる
  └─ 比率: 13%（194問）
  └─ 目的: 用語理解の深化

Pattern 4: 複数の条件が同時に必要な場合、優先順位構造を隠した問題
  └─ 比率: 18%（268問）
  └─ 目的: 複合条件判定能力

Pattern 5: 複数の法律が関わる場合の相互関係を理解させる
  └─ 比率: 10%（149問）
  └─ 目的: 関連法令理解

Pattern 6: シナリオに基づいて、場合分けの理解を問う問題
  └─ 比率: 8%（119問）
  └─ 目的: 実務的応用力
```

#### 運転免許試験から統合された3パターン

```
Pattern 7: 時間経過による法的ステータス変化（許可失効など）
  └─ 比率: 4%（60問）
  └─ 目的: 時系列理解、失効・再取得の理解
  └─ 源: 運転免許試験分析

Pattern 8: 複数違反時の優先度判定（最優先措置は何か）
  └─ 比率: 2%（30問）
  └─ 目的: 優先順位判定、複合違反への対応
  └─ 源: 運転免許試験分析

Pattern 9: 法令改正による例外関係（旧法と新法の関係）
  └─ 比率: 2%（30問）
  └─ 目的: 改正法への対応、新旧条文の理解
  └─ 源: 運転免許試験分析
```

---

### 3. 難易度分布

```
easy (簡単):  447問 (30%)
  └─ 基本知識のみで回答可能

medium (中):  746問 (50%)
  └─ 複合条件・例外認識が必要

hard (難):    298問 (20%)
  └─ 複数法令・シナリオ判定が必要
```

---

## 🎯 仕様の特徴

### 1. 細粒度化の実現

```
❌ V6の失敗: 1491 → 7カテゴリ → テンプレート
              ↓
              単一形式・意味不明

✅ 新方式: 1491問 → 7カテゴリ
            ↓
            46サブトピック（平均 32問/トピック）
            ↓
            9パターン（複数選択可能）
            ↓
            多様で意味ある問題
```

### 2. 複数ロジックのコンテキスト化

```
各サブトピック × パターン 9種類
= 異なるロジックで同じトピックを多角的に出題
```

### 3. 運転免許試験分析の統合

```
Pattern 7-9: 時系列変化、優先度判定、改正法対応
  → 遊技機試験にも適用可能
  → 実務に基づいた実践的な出題
```

---

## 📊 統計

```
総問数: 1491問
カテゴリ: 7個
サブトピック: 46個（平均 32.4問/トピック）
パターン: 9種類
難易度: 3段階（easy/medium/hard）
```

---

## ✅ 完成チェックリスト

- [x] ソースから詳細なサブトピック抽出
- [x] Worker2が設計した9パターンを発見・統合
- [x] 運転免許試験分析の適用（Pattern 7-9）
- [x] カテゴリ別の詳細配分計画
- [x] 難易度分布の定義
- [x] 仕様書の文書化

---

## 📝 次のステップ（実装前）

### ステップ1: コンテキスト化（JSON構造化）
- 仕様をJSON形式で機械可読化
- Advanced Generatorに入力可能な構造に整備

### ステップ2: Advanced Generatorへの統合
- コンテキストを入力として問題生成
- 9パターンの自動選択・適用

### ステップ3: 生成実行
- 詳細な仕様に基づいた1491問の生成

---

## 📌 重要なポイント

### ユーザーのご指摘を反映

| ご指摘 | 対応 |
|--------|------|
| 「粒度が低い」 | サブトピック化（46個） |
| 「具体的に何に関するもか」 | 各サブトピックに詳細記述 |
| 「複数ロジックをコンテキスト化」 | 9パターンを定義・配分 |
| 「運転免許試験を参考に」 | Pattern 7-9として統合 |
| 「仕様が出来てからだ」 | ✅ 本文書で完成宣言 |

---

## 📋 参考資料

| ファイル | 内容 |
|---------|------|
| `DETAILED_EXAM_SPECIFICATION.md` | カテゴリ別サブトピック詳細 |
| `ultimate-problem-generator-v2.js` | Worker2設計の9パターン実装 |
| `PATSHINKO_EXAM_STRUCTURE.json` | OCRから抽出したサブトピック JSON |
| `EXTERNAL_SOURCES.md` | Worker2分析の記録（最高品質問題生成エンジンv2） |

---

## ✅ 結論

**仕様定義は完了しました。**

### これまでのプロセス

```
V6失敗
  ↓
根本原因分析（テンプレート方式）
  ↓
RAG + Advanced Generator への回帰
  ↓
仕様書作成（カテゴリ・サブトピック化）
  ↓
Worker2の9パターン発見・統合
  ↓
✅ 仕様完成

次: 実装フェーズへ
```

**ユーザーの指示**: 「仕様が出来てからだ」
**現状**: ✅ 仕様完成。実装開始可能。

