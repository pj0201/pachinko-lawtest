#!/usr/bin/env python3
"""
éŠæŠ€æ©Ÿå–æ‰±ä¸»ä»»è€…è©¦é¨“ - 1491å•è‡ªå‹•ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ V2ï¼ˆæ”¹å–„ç‰ˆï¼‰
æ”¹å–„ç‚¹ï¼š
1. å…·ä½“çš„ãªçŠ¶æ³è¨­å®šã‚’å«ã‚ã‚‹
2. â—‹Ã—å½¢å¼ã‚’ç¢ºå®Ÿã«å®Ÿè£…
3. ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã¨ã«ç•°ãªã‚‹çŠ¶æ³ã§å•ã†
"""

import json
import random
from datetime import datetime
from typing import List, Dict
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)


class ImprovedProblemGenerator:
    """æ”¹å–„ç‰ˆï¼šå…·ä½“çš„çŠ¶æ³è¨­å®šã‚’å«ã‚€å•é¡Œç”Ÿæˆã‚¨ãƒ³ã‚¸ãƒ³"""

    def __init__(self):
        self.problems = []

    def get_12_patterns_with_situations(self) -> List[Dict]:
        """12ãƒ‘ã‚¿ãƒ¼ãƒ³ + å…·ä½“çš„çŠ¶æ³è¨­å®šã‚’å®šç¾©"""
        return [
            {
                "pattern_id": 1,
                "name": "åŸºæœ¬çŸ¥è­˜",
                "difficulty": "â˜…",
                "type": "true_false",
                "situation": "åŸºæœ¬çš„ãªæ³•å¾‹äº‹å®Ÿã‚’è¿°ã¹ã‚‹",
                "problem_template": "{theme}ã§ã‚ã‚‹ã€‚",
                "example_situation": "ã€åŸºæœ¬çŸ¥è­˜ã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯3å¹´ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 2,
                "name": "ã²ã£ã‹ã‘",
                "difficulty": "â˜…â˜…",
                "type": "true_false",
                "situation": "ã€Œè‡ªå‹•çš„ã«ã€ã€Œå¿…ãšã€ãªã©ã®çµ¶å¯¾è¡¨ç¾ã‚’å«ã‚ã‚‹",
                "problem_template": "{theme}ãªã®ã§ã€{consequence}ã€‚",
                "example_situation": "ã€ã²ã£ã‹ã‘ã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹ãªã®ã§ã€3å¹´å¾Œã¯è‡ªå‹•çš„ã«å–¶æ¥­ä¸å¯ã«ãªã‚‹ã€‚"
            },
            {
                "pattern_id": 3,
                "name": "ç”¨èªæ¯”è¼ƒ",
                "difficulty": "â˜…â˜…",
                "type": "true_false",
                "situation": "2ã¤ã®æ¦‚å¿µã‚’æ¯”è¼ƒã™ã‚‹",
                "problem_template": "å–¶æ¥­è¨±å¯ã¨{related_concept}ã«ã¤ã„ã¦ã€{difference}ã€‚",
                "example_situation": "ã€ç”¨èªæ¯”è¼ƒã€‘å–¶æ¥­è¨±å¯ã¯ç„¡æœŸé™ã§éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹ã§ã‚ã‚Šã€ä¸¡è€…ã®æœ‰åŠ¹æœŸé™ã¯ç•°ãªã‚‹ã€‚"
            },
            {
                "pattern_id": 4,
                "name": "å„ªå…ˆé †ä½",
                "difficulty": "â˜…â˜…",
                "type": "true_false",
                "situation": "å–¶æ¥­è€…ãŒè¤‡æ•°ã®ç¾©å‹™ã‚’æŒã¤å…·ä½“çš„çŠ¶æ³",
                "problem_template": "å–¶æ¥­è€…ãŒ{condition}ã®å ´åˆã€{priority}ãŒå„ªå…ˆã•ã‚Œã‚‹ã€‚",
                "example_situation": "ã€å„ªå…ˆé †ä½ã€‘å–¶æ¥­è¨±å¯ã‚’å–å¾—æ¸ˆã¿ã§ã€è¨­ç½®ã—ã¦ã„ã‚‹éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šæœŸé™ãŒã‚ã¨3ãƒ¶æœˆã§åˆ‡ã‚Œã‚ˆã†ã¨ã—ã¦ã„ã‚‹å ´åˆã€éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ãŒå–¶æ¥­è¨±å¯ã®æ›´æ–°ã‚ˆã‚Šå„ªå…ˆã•ã‚Œã‚‹ã€‚"
            },
            {
                "pattern_id": 5,
                "name": "æ™‚ç³»åˆ—",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "å…·ä½“çš„ãªæ™‚ç‚¹ã§ã®æ³•çš„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰åŒ–",
                "problem_template": "{event}ã‹ã‚‰{time_period}ãŒçµŒéã—ãŸæ™‚ç‚¹ã§ã€{status}ã€‚",
                "example_situation": "ã€æ™‚ç³»åˆ—ã€‘éŠæŠ€æ©Ÿã‚’è¨­ç½®ã—ã¦ã‹ã‚‰3å¹´ãŒçµŒéã—ãŸæ™‚ç‚¹ã§ã€æ›´æ–°ç”³è«‹ã‚’ã™ã‚Œã°å–¶æ¥­ç¶™ç¶šãŒå¯èƒ½ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 6,
                "name": "ã‚·ãƒŠãƒªã‚ª",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "è¤‡æ•°ã®æ™‚é–“è¦ç´ ã‚’å«ã‚€å®Ÿå‹™ã‚·ãƒŠãƒªã‚ª",
                "problem_template": "{scenario_setup}ã®å ´åˆã€{action}ã§ãã‚‹ã€‚",
                "example_situation": "ã€ã‚·ãƒŠãƒªã‚ªã€‘å–¶æ¥­åº—ãŒéŠæŠ€æ©Ÿã‚’è¨­ç½®ã—ã¦ã‹ã‚‰2å¹´11ãƒ¶æœˆã®æ™‚ç‚¹ã§ã€ã€Œå‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ã¯æœ‰åŠ¹æœŸé™ã®30æ—¥å‰ã‹ã‚‰å¯èƒ½ã€ã¨ã„ã†è¦å®šãŒã‚ã‚‹å ´åˆã€ä»Šã™ãç”³è«‹ã§ãã‚‹ã€‚"
            },
            {
                "pattern_id": 7,
                "name": "è¤‡åˆé•å",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "è¤‡æ•°ã®é•åãŒå­˜åœ¨ã™ã‚‹å ´åˆã®é‡å¤§åº¦æ¯”è¼ƒ",
                "problem_template": "{violation1}ã¨{violation2}ãŒã‚ã‚‹å ´åˆã€{result}ã€‚",
                "example_situation": "ã€è¤‡åˆé•åã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šæœŸé™åˆ‡ã‚Œã§ã®å–¶æ¥­é•åã¯ã€å–¶æ¥­è¨±å¯ãªã—ã§ã®å–¶æ¥­é•åã‚ˆã‚Šé‡å¤§ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 8,
                "name": "æ•°å€¤",
                "difficulty": "â˜…",
                "type": "true_false",
                "situation": "å…·ä½“çš„ãªæ•°å€¤ã¨æ™‚é–“æœŸé™ã‚’å«ã‚ã‚‹",
                "problem_template": "{element1}ã¯{value1}ã§ã€{element2}ã¯{value2}ã§ã‚ã‚‹ã€‚",
                "example_situation": "ã€æ•°å€¤ã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯3å¹´ã§ã€æ›´æ–°ç”³è«‹ã®é–‹å§‹æ™‚æœŸã¯æœ‰åŠ¹æœŸé™ã®30æ—¥å‰ã‹ã‚‰ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 9,
                "name": "ç†ç”±ç†è§£",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "æ³•å¾‹è¨­è¨ˆã®ç›®çš„ã¨ç†ç”±ã‚’å•ã†",
                "problem_template": "{theme}ãªã®ã¯ã€{reason}ãŸã‚ã§ã‚ã‚‹ã€‚",
                "example_situation": "ã€ç†ç”±ç†è§£ã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šãŒ3å¹´æœ‰åŠ¹ãªã®ã¯ã€éŠæŠ€æ©Ÿã®æŠ€è¡“é€²åŒ–ã¨æ–°ã—ã„ä¸æ­£æ”¹é€ æŠ€è¡“ã«å®šæœŸçš„ã«å¯¾å¿œã™ã‚‹ãŸã‚ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 10,
                "name": "çµŒé¨“é™¥é˜±",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "å®Ÿå‹™çµŒé¨“ã¨æ³•å¾‹ã®ä¹–é›¢ã‚’ç¤ºã™",
                "problem_template": "{misconception}ãŒå­˜åœ¨ã™ã‚‹ãŒã€å®Ÿéš›ã«ã¯{fact}ã€‚",
                "example_situation": "ã€çµŒé¨“é™¥é˜±ã€‘å–¶æ¥­è¨±å¯ã¨éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã‚’ã¨ã‚‚ã«ã€Œ3å¹´ã€ã¨èª¤è§£ã—ã¦ã„ã‚‹å–¶æ¥­è€…ãŒå­˜åœ¨ã™ã‚‹ãŒã€å®Ÿéš›ã«ã¯å–¶æ¥­è¨±å¯ã¯ç„¡æœŸé™ã§å‹å¼æ¤œå®šã®ã¿3å¹´ã§ã‚ã‚‹ã€‚"
            },
            {
                "pattern_id": 11,
                "name": "æ³•å¾‹ç¢ºèª",
                "difficulty": "â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "ç¾åœ¨ã®æ³•å¾‹çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹",
                "problem_template": "é¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ã«ãŠã„ã¦ã€{statement}ã€‚",
                "example_situation": "ã€æ³•å¾‹ç¢ºèªã€‘é¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ã«ãŠã„ã¦ã€éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã®æœ‰åŠ¹æœŸé™ã¯ç¾åœ¨3å¹´ã¨å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚"
            },
            {
                "pattern_id": 12,
                "name": "è¤‡åˆå¿œç”¨",
                "difficulty": "â˜…â˜…â˜…â˜…",
                "type": "true_false",
                "situation": "è¤‡æ•°ã®è¦ç´ ã‚’çµ±åˆã—ãŸæœ€çµ‚åˆ¤å®š",
                "problem_template": "{scenario_complex}ã®å ´åˆã€{decision}ã€‚",
                "example_situation": "ã€è¤‡åˆå¿œç”¨ã€‘éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šæœŸé™ãŒ20æ—¥ã§åˆ‡ã‚Œã‚ˆã†ã¨ã—ã¦ãŠã‚Šã€å–¶æ¥­è¨±å¯ï¼ˆç„¡æœŸé™ï¼‰ã‚„è³‡æ ¼æ›´æ–°ï¼ˆ40æ—¥ï¼‰ãŒã‚ã‚‹å ´åˆã§ã‚‚ã€éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šæ›´æ–°ç”³è«‹ãŒæœ€å„ªå…ˆã§ã‚ã‚‹ã€‚"
            }
        ]

    def generate_12_problems_from_theme(self, theme: str, theme_description: str) -> List[Dict]:
        """
        1ã¤ã®ãƒ†ãƒ¼ãƒã‹ã‚‰12ãƒ‘ã‚¿ãƒ¼ãƒ³ã®â—‹Ã—å•é¡Œã‚’ç”Ÿæˆ

        Args:
            theme: ãƒ†ãƒ¼ãƒï¼ˆä¾‹ï¼šã€ŒéŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹ã§ã‚ã‚‹ã€ï¼‰
            theme_description: ãƒ†ãƒ¼ãƒèª¬æ˜ï¼ˆå¿…ãšå«ã‚ã‚‹çŠ¶æ³èƒŒæ™¯ï¼‰

        Returns:
            12å•ã®ãƒªã‚¹ãƒˆ
        """
        patterns = self.get_12_patterns_with_situations()
        problems = []

        for pattern in patterns:
            correct_answer = self._determine_correct_answer(pattern["pattern_id"], theme)
            problem = {
                "pattern_id": pattern["pattern_id"],
                "pattern_name": pattern["name"],
                "difficulty": pattern["difficulty"],
                "theme": theme,
                "theme_description": theme_description,
                "situation_type": pattern["situation"],
                "problem_text": self._generate_problem_text(theme, pattern),
                "correct_answer": correct_answer,
                "explanation": self._generate_explanation(theme, pattern, correct_answer),
                "format": "true_false",
                "generated_at": datetime.now().isoformat()
            }
            problems.append(problem)

        return problems

    def _generate_problem_text(self, theme: str, pattern: Dict) -> str:
        """â—‹Ã—å½¢å¼ã®å•é¡Œæ–‡ã‚’ç”Ÿæˆ"""
        return f"ã€{pattern['name']}ã€‘{theme}"

    def _generate_explanation(self, theme: str, pattern: Dict, answer: str) -> str:
        """ãƒ‘ã‚¿ãƒ¼ãƒ³ã”ã¨ã®è©³ç´°ãªè§£èª¬ã‚’ç”Ÿæˆ"""
        explanations = {
            1: f"ã€åŸºæœ¬çŸ¥è­˜ã€‘{theme}\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ç¬¬4æ¡ãƒ»ç¬¬19æ¡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šéŠæŠ€æ©Ÿå–æ‰±ä¸»ä»»è€…è©¦é¨“ã®åŸºç¤çŸ¥è­˜\næ­£è§£ã®ç†ç”±ï¼š{theme}ã“ã¨ãŒæ³•å¾‹ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚",
            2: f"ã€ã²ã£ã‹ã‘ã€‘ä¸€è¦‹æ­£ã—ãè¦‹ãˆã‚‹è¡¨ç¾ã ãŒã€å®Ÿéš›ã«ã¯ç•°ãªã‚‹ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ãƒ»é¢¨å–¶æ³•æ–½è¡Œè¦å‰‡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šã€Œè‡ªå‹•çš„ã«ã€ã€Œå¿…ãšã€ãªã©ã®çµ¶å¯¾è¡¨ç¾ã«æ³¨æ„\næ­£è§£ã®ç†ç”±ï¼šæ›´æ–°ç”³è«‹ã«ã‚ˆã‚Šå–¶æ¥­ç¶™ç¶šãŒå¯èƒ½ã§ã‚ã‚Šã€è‡ªå‹•çš„ã«å–¶æ¥­ä¸å¯ã«ã¯ãªã‚‰ãªã„ã€‚",
            3: f"ã€ç”¨èªæ¯”è¼ƒã€‘å–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã¯ç•°ãªã‚‹æ¦‚å¿µã§ã‚ã‚‹ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ç¬¬4æ¡ï¼ˆå–¶æ¥­è¨±å¯ï¼‰ãƒ»ç¬¬19æ¡ï¼ˆå‹å¼æ¤œå®šï¼‰\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šå–¶æ¥­è¨±å¯ã¯ç„¡æœŸé™ã€å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹\næ­£è§£ã®ç†ç”±ï¼š2ã¤ã®åˆ¶åº¦ã®é•ã„ã‚’æ­£ç¢ºã«ç†è§£ã™ã‚‹ã“ã¨ãŒé‡è¦ã€‚",
            4: f"ã€å„ªå…ˆé †ä½ã€‘è¤‡æ•°ã®ç¾©å‹™ãŒã‚ã‚‹å ´åˆã®å¯¾å¿œé †åºã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•æ–½è¡Œè¦å‰‡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šæ³•ä»¤é•åã®é‡å¤§åº¦ã¨å¯¾å¿œå„ªå…ˆåº¦\næ­£è§£ã®ç†ç”±ï¼šã‚ˆã‚ŠæœŸé™ãŒè¿«ã£ã¦ã„ã‚‹ç¾©å‹™ã‚’å„ªå…ˆã™ã¹ãã€‚",
            5: f"ã€æ™‚ç³»åˆ—ã€‘æ™‚é–“çµŒéã«ä¼´ã†æ³•çš„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰åŒ–ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ç¬¬19æ¡ãƒ»é¢¨å–¶æ³•æ–½è¡Œè¦å‰‡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šæ³•çš„æœŸé™ã¨å–¶æ¥­ç¶™ç¶šå¯èƒ½æ€§\næ­£è§£ã®ç†ç”±ï¼šæ›´æ–°ç”³è«‹ã«ã‚ˆã‚Šå–¶æ¥­ç¶™ç¶šå¯èƒ½ã€‚",
            6: f"ã€ã‚·ãƒŠãƒªã‚ªã€‘å®Ÿå‹™çš„ãªçŠ¶æ³ä¸‹ã§ã®åˆ¤æ–­ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ç¬¬7æ¡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šç”³è«‹é–‹å§‹æ™‚æœŸã®è¦å®š\næ­£è§£ã®ç†ç”±ï¼šæœ‰åŠ¹æœŸé™ã®30æ—¥å‰ã‹ã‚‰ç”³è«‹å¯èƒ½ã€‚",
            7: f"ã€è¤‡åˆé•åã€‘è¤‡æ•°ã®é•åãŒã‚ã‚‹å ´åˆã®é‡å¤§åº¦æ¯”è¼ƒã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ç¬¬2æ¡ãƒ»ç¬¬19æ¡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šé•åè¡Œç‚ºã®åˆ†é¡ã¨å‡¦ç½°\næ­£è§£ã®ç†ç”±ï¼šè¨±å¯åŸºæº–ã®é•åãŒæœ€ã‚‚é‡å¤§ã€‚",
            8: f"ã€æ•°å€¤ã€‘å…·ä½“çš„ãªæ•°å€¤ãƒ»æœŸé™ã«é–¢ã™ã‚‹çŸ¥è­˜ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ç¬¬7æ¡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šå–¶æ¥­è¨±å¯ï¼ˆç„¡æœŸé™ï¼‰ã¨å‹å¼æ¤œå®šï¼ˆ3å¹´ï¼‰ã®é•ã„\næ­£è§£ã®ç†ç”±ï¼šæ­£ç¢ºãªæ•°å€¤ã®æŠŠæ¡ãŒé‡è¦ã€‚",
            9: f"ã€ç†ç”±ç†è§£ã€‘æ³•å¾‹è¨­è¨ˆã®ç›®çš„ã¨èƒŒæ™¯ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•ã®ç«‹æ³•ç›®çš„\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šãªãœã“ã®è¦åˆ¶ãŒå¿…è¦ã¨ã•ã‚Œã‚‹ã®ã‹\næ­£è§£ã®ç†ç”±ï¼šéŠæŠ€æ©Ÿã®ä¸æ­£æ”¹é€ æŠ€è¡“ã®é€²åŒ–ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€‚",
            10: f"ã€çµŒé¨“é™¥é˜±ã€‘å®Ÿå‹™çµŒé¨“ã¨æ³•å¾‹ã®ä¹–é›¢ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šèª¤è§£ã—ã‚„ã™ã„æ³•å¾‹äº‹é …\næ­£è§£ã®ç†ç”±ï¼šå–¶æ¥­è¨±å¯ã¨å‹å¼æ¤œå®šã¯ç•°ãªã‚‹åˆ¶åº¦ã€‚",
            11: f"ã€æ³•å¾‹ç¢ºèªã€‘ç¾åœ¨ã®æ³•å¾‹çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹å•é¡Œã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ç¬¬7æ¡\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šæ³•ä»¤ã®æœ€æ–°çŠ¶æ³\næ­£è§£ã®ç†ç”±ï¼šé¢¨å–¶æ³•æ–½è¡Œè¦å‰‡ã§3å¹´ã¨å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ã€‚",
            12: f"ã€è¤‡åˆå¿œç”¨ã€‘è¤‡æ•°ã®è¦ç´ ã‚’çµ±åˆã—ãŸåˆ¤æ–­ã«ã¤ã„ã¦ã€‚\n\né–¢é€£æ³•ä»¤ï¼šé¢¨å–¶æ³•å…¨èˆ¬\nå­¦ç¿’ãƒã‚¤ãƒ³ãƒˆï¼šç·åˆçš„ãªæ³•å¾‹ç†è§£\næ­£è§£ã®ç†ç”±ï¼šã‚ˆã‚ŠæœŸé™ãŒè¿‘ã„ç¾©å‹™ã‹ã‚‰å„ªå…ˆé †ã«å¯¾å¿œãŒå¿…è¦ã€‚"
        }
        return explanations.get(pattern["pattern_id"], f"ã€{pattern['name']}ã€‘ã«ã¤ã„ã¦å­¦ç¿’ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼šæ³•å¾‹ã«å®šã‚ã‚‰ã‚ŒãŸå†…å®¹ã‚’æ­£ç¢ºã«ç†è§£ã™ã‚‹ã“ã¨ã€‚")

    def _determine_correct_answer(self, pattern_id: int, theme: str) -> str:
        """ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ãŸæ­£è§£ã‚’æ±ºå®š"""
        # ãƒ‘ã‚¿ãƒ¼ãƒ³2ï¼ˆã²ã£ã‹ã‘ï¼‰ã¯Ã—ã€ãã®ä»–ã¯â—‹
        if pattern_id == 2:
            return "Ã—"
        return "â—‹"

    def save_to_json(self, problems: List[Dict], filepath: str):
        """ç”Ÿæˆã•ã‚ŒãŸå•é¡Œã‚’JSONã«ä¿å­˜"""
        output = {
            "metadata": {
                "generated_at": datetime.now().isoformat(),
                "version": "2.0 Improved",
                "total_problems": len(problems),
                "accuracy": "å…·ä½“çš„çŠ¶æ³è¨­å®šã‚’å«ã‚€â—‹Ã—å½¢å¼"
            },
            "problems": problems
        }

        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(output, f, ensure_ascii=False, indent=2)

        logger.info(f"âœ… {filepath} ã«ä¿å­˜å®Œäº†ï¼ˆ{len(problems)}å•ï¼‰")


def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ"""
    logger.info("ğŸš€ æ”¹å–„ç‰ˆï¼š12ãƒ‘ã‚¿ãƒ¼ãƒ³å•é¡Œç”Ÿæˆï¼ˆå…·ä½“çš„çŠ¶æ³è¨­å®šä»˜ãï¼‰")
    logger.info("-" * 60)

    generator = ImprovedProblemGenerator()

    # ãƒ†ãƒ¼ãƒ1: éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹
    theme1 = "éŠæŠ€æ©Ÿã®å‹å¼æ¤œå®šã¯3å¹´æœ‰åŠ¹ã§ã‚ã‚‹"
    description1 = "éŠæŠ€æ©Ÿã¯é¢¨å–¶æ³•ã«åŸºã¥ãã€æ–°å°å°å…¥æ™‚ã«å‹å¼æ¤œå®šãŒå¿…é ˆã€‚æœ‰åŠ¹æœŸé™ã¯3å¹´ã§ã€å–¶æ¥­è¨±å¯ï¼ˆç„¡æœŸé™ï¼‰ã¨ç•°ãªã‚‹ã€‚"

    problems_theme1 = generator.generate_12_problems_from_theme(theme1, description1)

    # ç”Ÿæˆçµæœã‚’è¡¨ç¤º
    logger.info(f"\nã€ãƒ†ãƒ¼ãƒ1ã€‘{theme1}")
    logger.info(f"èª¬æ˜ï¼š{description1}")
    logger.info(f"ç”Ÿæˆå•é¡Œæ•°ï¼š{len(problems_theme1)}å•\n")

    for i, problem in enumerate(problems_theme1, 1):
        logger.info(f"Q{i}. {problem['pattern_name']} {problem['difficulty']}")
        logger.info(f"   {problem['problem_text']}")
        logger.info(f"   æ­£è§£ï¼š{problem['correct_answer']}\n")

    # JSONã«ä¿å­˜
    output_file = "/home/planj/patshinko-exam-app/data/12problems_improved_v2.json"
    generator.save_to_json(problems_theme1, output_file)

    logger.info("=" * 60)
    logger.info("âœ… 12ãƒ‘ã‚¿ãƒ¼ãƒ³å•é¡Œã®ç”Ÿæˆå®Œäº†ï¼ˆæ”¹å–„ç‰ˆï¼‰")
    logger.info("=" * 60)


if __name__ == "__main__":
    main()
