# 開発モード / 本番環境復帰ガイド

## 📋 現在の状態

✅ **開発モード（有効中）**
- セッション検証をスキップ
- パソコンのローカルホストでテスト可能
- 招待URLなしでログイン可能

---

## 🔄 本番環境への復帰手順

### **ステップ1: 環境変数を変更**

ファイル: `.env.local`

```bash
# 変更前
VITE_DEV_MODE=true

# 変更後
VITE_DEV_MODE=false
```

### **ステップ2: Viteを再起動**

```bash
# 現在のViteを停止
Ctrl+C (ターミナルで)

# または
killall node

# 再起動
npm run dev
```

### **ステップ3: 確認**

```bash
# ローカルホストでアクセス
http://localhost:5173

# → 招待URLなしでアクセスすると
#   /register ページにリダイレクトされる ✅
```

### **ステップ4: 本番ビルド**

```bash
# 本番環境用にビルド
npm run build

# ビルド完了後、デプロイ
# → 招待URL検証 + 1台制限が有効になる
```

---

## 🔍 設定ファイル一覧

| ファイル | 用途 | 開発モード | 本番モード |
|---------|------|-----------|----------|
| `.env.local` | ローカル設定 | `VITE_DEV_MODE=true` | `VITE_DEV_MODE=false` |
| `src/components/ProtectedRoute.jsx` | セッション検証 | スキップ | 招待URL検証 |
| `vite.config.js` | ビルド設定 | （変更不要） | （変更不要） |

---

## ⚠️ 注意事項

### 開発モード中の制限

- ✅ ローカルホストからのみ有効
- ✅ ngrok（スマホアクセス）では開発モードが**無効**
- ✅ 本番環境では自動的に招待URL検証に切り替わる

### 本番環境チェックリスト

- [ ] `.env.local` で `VITE_DEV_MODE=false` に設定
- [ ] Vite再起動後、招待URLなしのアクセスでリダイレクト確認
- [ ] `npm run build` で本番ビルド
- [ ] ngrokやスマホからのアクセスで招待URL検証が有効か確認
- [ ] 1台1アカウント制限が機能しているか確認

---

## 🆘 トラブルシューティング

### Q: 本番環境に変更したのに、まだセッション検証がスキップされる

**A:** Viteのキャッシュが残っている可能性があります

```bash
# キャッシュ削除
rm -rf node_modules/.vite

# Vite再起動
npm run dev
```

### Q: 本番環境でも開発モードが有効になってしまう

**A:** `.env.local` が本番環境にも適用されている可能性があります

```bash
# 本番環境では .env.local を削除（またはリネーム）
mv .env.local .env.local.bak

# デプロイ時には環境変数を明示的に設定
VITE_DEV_MODE=false npm run build
```

---

**更新日時**: 2025-10-24
**担当**: Claude Code
