# 🎯 OPUS生成ロジック設計書
作成日: 2025-10-23
作成者: Claude OPUS Model

## 📋 基本方針

### 問題生成目標
- **初期生成**: 300問（高品質担保）
- **最終統合**: 実装済み約600問と合併して900問目標

### 品質保証原則
1. **明確性**: 何を問うているか一目瞭然
2. **正確性**: 法的根拠が明確
3. **単純性**: 1問題1論点（複雑化しない）
4. **実用性**: 実務に即した内容

---

## 🎮 10パターン体系（新）

### パターン定義

| # | パターン名 | 説明 | 例 |
|---|----------|------|-----|
| 1 | **基本事実確認** | 法令の正確な内容を問う | 「営業許可は無期限有効である」→○ |
| 2 | **数値正誤** | 日数・金額・罰則の数値 | 「型式検定の有効期限は3年である」→○ |
| 3 | **手続き順序** | 前後関係・タイミング | 「遊技機設置は事前届出が必要である」→○ |
| 4 | **適用範囲** | 対象・除外を明確化 | 「中古機も型式検定が必要である」→○ |
| 5 | **必要条件** | 必須/任意の区別 | 「管理者業務は取扱主任者が代行できる」→○ |
| 6 | **禁止事項** | してはいけないこと | 「客引き行為は禁止されている」→○ |
| 7 | **例外規定** | ただし書き・除外事項 | 「認定を受けた遊技機は検定不要である」→× |
| 8 | **用語定義** | 正確な意味・定義 | 「営業所には駐車場も含まれる」→× |
| 9 | **責任主体** | 誰が行うか | 「型式検定は公安委員会が行う」→○ |
| 10 | **時限規定** | 期限・有効期間 | 「営業停止命令は最大6ヶ月である」→○ |

---

## 🔄 誤り生成ルール（運転免許試験型）

### 基本ルール
1. **1箇所だけ誤り**: 複数の誤りを含まない
2. **明確な誤り**: あいまいさを排除
3. **実務的誤り**: 実際に間違えやすい内容

### 誤り生成パターン

#### A. 数値変更型
```
正: 型式検定の有効期限は3年である
誤: 型式検定の有効期限は5年である
```

#### B. 必須/任意変更型
```
正: 営業許可申請には添付書類が必要である（必須）
誤: 営業許可申請には添付書類を添付できる（任意）
```

#### C. 主体変更型
```
正: 型式検定は国家公安委員会が行う
誤: 型式検定は都道府県公安委員会が行う
```

#### D. 例外と原則の逆転型
```
正: 認定を受けた遊技機も型式検定の対象である
誤: 認定を受けた遊技機は型式検定の対象外である
```

#### E. 絶対表現の不適切追加型
```
正: 遊技機の不正改造は禁止されている
誤: 遊技機の改造は絶対に禁止されている（部品交換は可能）
```

---

## 📝 50具体的テーマ（講習テキストベース）

### カテゴリ1: 遊技機管理（20テーマ）
1. 新台設置の届出手続き
2. 中古遊技機の型式確認
3. 遊技機の部品交換手続き
4. 製造番号の管理
5. 基板ケースの封印管理
6. 遊技機の保守点検頻度
7. 故障機の取扱い
8. 遊技機の廃棄手続き
9. 遊技機の移設手続き
10. 外部端子板の管理
11. 遊技機の認定申請
12. 遊技機の増設手続き
13. 検定有効期限の管理
14. 遊技機台帳の記載事項
15. 中古機の流通管理
16. 遊技機の設置基準
17. 遊技球等の管理
18. リサイクル機の取扱い
19. 遊技機メーカーとの契約
20. 遊技機の性能確認

### カテゴリ2: 不正対策（10テーマ）
21. 不正改造の検出方法
22. 不正機器の発見時対応
23. 基板の不正確認
24. ROM交換の禁止事項
25. セキュリティチップ管理
26. 不正防止の日常点検
27. 不正通報の義務
28. 不正改造の罰則
29. 従業員による不正防止
30. 外部業者の管理

### カテゴリ3: 営業時間・規制（5テーマ）
31. 営業禁止時間帯
32. 年少者立入制限
33. 営業停止命令の期間
34. 騒音規制基準
35. 照度規制基準

### カテゴリ4: 営業許可関連（5テーマ）
36. 営業許可の有効期限
37. 営業許可の承継
38. 許可証の掲示義務
39. 営業許可の取消事由
40. 構造設備の変更届

### カテゴリ5: 型式検定関連（5テーマ）
41. 型式検定の有効期限
42. 型式検定の更新時期
43. 検定申請の手続き
44. 検定機関の種類
45. 検定と認定の違い

### カテゴリ6: 景品規制（5テーマ）
46. 景品の上限額
47. 特殊景品の種類
48. 買取所との関係
49. 景品交換の記録
50. 風営法第22条の内容

---

## 🔧 実装手順

### Phase 1: データ準備（完了）
✅ 講習テキストOCRデータ活用
✅ 風営法条文データ準備
✅ 50テーマ選定

### Phase 2: 問題生成
1. テーマ×パターンマトリックス作成（50×10=500候補）
2. 重要度に応じて300問を選別
3. 正しい文章生成
4. 誤り文章生成（1箇所変更）
5. 解説文作成
6. 法的根拠明記

### Phase 3: 品質チェック
1. 明確性確認（意味不明でないか）
2. 正確性確認（法的根拠あり）
3. 重複排除
4. 難易度バランス調整

### Phase 4: 統合
1. 実装済み約600問の品質チェック
2. 新300問との重複確認
3. 最終900問セット作成

---

## 📊 出力形式

```json
{
  "problem_id": 1,
  "theme_id": "T01",
  "theme_name": "営業許可の有効期限",
  "pattern_id": "P01",
  "pattern_name": "基本事実確認",
  "category": "営業許可関連",
  "difficulty": "★",
  "problem_text": "風営法における営業許可は、一度取得すると更新の必要がない。",
  "correct_answer": "○",
  "explanation": "営業許可は無期限有効であり、更新手続きは不要です。",
  "legal_reference": "風営法第5条",
  "source": "講習テキストP.20"
}
```

---

## ✅ 品質保証チェックリスト

### 問題文チェック
- [ ] 1文で完結している
- [ ] 主語・述語が明確
- [ ] 専門用語は正確
- [ ] 数値は正確
- [ ] 二重否定を避ける

### 解説チェック
- [ ] 正解理由が明確
- [ ] 法的根拠を明記
- [ ] 実務的観点を含む
- [ ] 簡潔で分かりやすい

### 全体チェック
- [ ] カテゴリ分布が適切
- [ ] 難易度分布が適切
- [ ] 重複問題がない
- [ ] 実装済み問題と矛盾しない