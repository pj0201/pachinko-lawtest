# 品質改善ガイド：ディストラクタ・ひっかけ度強化版

**目的**: デモスコア 0.73点 → 本生成スコア 0.80点以上の達成
**実装**: Week 7本生成実施前に適用

---

## 📊 **スコア改善の目標値**

### **現在のデモスコア分析**

```
総合: 0.727点（良好）
├─ 明確性: 0.791点 ✅ (良い)
├─ ディストラクタ: 0.715点 ⚠️  (弱い)  ← 改善対象 #1
├─ 根拠性: 0.876点 ✅ (優秀)
└─ ひっかけ度: 0.500点 ❌ (弱い)  ← 改善対象 #2
```

### **目標値**

```
総合: 0.80点以上（優秀）
├─ 明確性: 0.79点 (変化なし)
├─ ディストラクタ: 0.80点以上 (+0.085改善)  ★ TARGET
├─ 根拠性: 0.88点 (変化なし)
└─ ひっかけ度: 0.70点以上 (+0.20改善)  ★ TARGET
```

---

## 🎯 **改善対策 #1: ディストラクタ強度の改善（0.715 → 0.80）**

### **問題点**

```
現状:
  - 選択肢の多様性が低い
  - ひっかけ要素が弱い
  - 「明らかに間違い」の選択肢が多すぎる
  - 「微妙な誤り」の選択肢が不足
```

### **改善方針: 選択肢の品質構造**

```
【理想的な4択の構成】

正答(A): 100% 正しい
  └─ 根拠: 条文・教材から明確に導ける

選択肢B (50% - 60%の人が選びやすい誤り):
  └─ 特性: 明らかに間違いだが一見説得力あり
  └─ 理由: 似た用語の誤解 OR 条件を部分的に誤った解釈
  └─ 学習者の典型的な誤り

選択肢C (30% - 40%の人が選びやすい誤り):
  └─ 特性: 関連概念だが異なる
  └─ 理由: テーマに関連するが別の規定 OR 別の分野の混同
  └─ 実務で混同しやすいパターン

選択肢D (20% - 30%の人が選びやすい誤り):
  └─ 特性: 微妙な誤り（難しく判断を要する）
  └─ 理由: 一部は正しいが条件や範囲が異なる
  └─ 上級者向けの判別ポイント
```

### **具体例：改善前 → 改善後**

#### **改善前（ディストラクタ品質が低い例）**

```
問: 「営業許可の有効期限について、正しいのはどれか」

A: 営業許可は無期限で有効である ← 正答
B: 営業許可は5年ごとの更新が必要である ← 明らかに間違い（でも弱い根拠）
C: 営業許可は営業実績があれば有効である ← 曖昧な誤り
D: 営業許可の有効期限は都道府県で異なる ← 詳しくないと選びにくい

問題点: B-Dが弱い。Bは「完全な間違い」で選ばない。CとDが判別困難。
```

#### **改善後（ディストラクタ品質が高い例）**

```
問: 「営業許可の有効期限について、正しいのはどれか」

A: 営業許可は無期限で有効である ← 正答（確実）
B: 営業許可は3年ごとに更新が必要である ← 学習者の典型的な誤り
  （理由: 型式検定が3年で混同しやすい）
C: 営業許可は5年ごとの講習受講が必要である ← 関連するが異なる
  （理由: 講習は実際に必要だが、許可の有効期限ではない）
D: 営業許可は営業者の営業実績がある限り有効である ← 微妙な誤り
  （理由: 「有効である」は正しいが、理由が不正確）

メリット:
  - B: 明らかな誤りだが「そっぽくない」
  - C: 関連概念で誤りやすい実践的な誤解
  - D: 一部は正しいが不正確（判断を要する）
  - 4択すべてに学習者を引き付ける力がある
```

---

## 🎯 **改善対策 #2: ひっかけ度制御の強化（0.50 → 0.70）**

### **問題点**

```
現状:
  - テンプレート別ひっかけ度が守られていない
  - T3, T5 でも 0.50（=50% の人が正答を選ぶ）
  - 応用問題なのに基礎水準の難易度になっている
```

### **改善方針: テンプレート別ひっかけ度の厳格化**

```
【テンプレート別の目標値】

T1 (基本知識):
  目標ひっかけ度: 15%（10-20%範囲）
  解釈: 85%の学習者が正答を選ぶべき
  生成方法: 明確な正答、関連するが異なる選択肢

T2 (条文直結):
  目標ひっかけ度: 35%（30-40%範囲）
  解釈: 65%の学習者が正答を選べる標準難易度
  生成方法: 似た条項を含める、微妙な誤りを含める

T3 (ひっかけ):
  目標ひっかけ度: 45%（40-50%範囲）
  解釈: 55%の学習者のみが正答を選べる高難易度
  生成方法: 4択すべてに説得力、慎重な判断が必要

T4 (複合条件):
  目標ひっかけ度: 35%（30-40%範囲）
  解釈: 複数条件で混同させるが標準難易度
  生成方法: 条件を入れ替えた選択肢、部分的に満たす選択肢

T5 (実務判断):
  目標ひっかけ度: 45%（40-50%範囲）
  解釈: 実務知識を要する高難易度
  生成方法: 実務的な誤り、実際に起こりやすいパターン
```

### **ひっかけ度を測定する方法**

```
【選択肢別の難易度配分（理想）】

正答(A): 55-60% の確率で選ばれる
  └─ 根拠: 条文に基づく、理屈が通る

選択肢B: 25-30% の確率で選ばれる
  └─ 理由: 似た用語の誤解、典型的な混同

選択肢C: 10-15% の確率で選ばれる
  └─ 理由: 関連概念だが異なる

選択肢D: 5-10% の確率で選ばれる
  └─ 理由: 詳しい者のみが誤りを見抜く

合計: 100%
ひっかけ度 = 1 - (正答率 / 100)
例: 正答率 55% → ひっかけ度 = 45%
```

---

## 📝 **Claude API プロンプト改善版**

### **システムプロンプト強化部分**

```
【重要】この指示を完全に守ってください

【ディストラクタ（選択肢）の品質基準】

選択肢の質は、問題の品質スコアの約30%を占めます。
必ず以下の基準を満たす選択肢を作成してください：

1. 正答は 「100% 正しい」
   - 根拠: 条文・教材から明確に導ける
   - 異論の余地がない

2. 選択肢B は 「似た用語や条件の誤解」
   - 特徴: 学習者が40-60%の確率で選びやすい誤り
   - 例: 型式検定と営業許可の混同、3年と無期限の混同
   - 一見説得力があるが、詳しく見ると間違い

3. 選択肢C は 「関連するが異なる概念」
   - 特徴: 20-30%の確率で選びやすい誤り
   - 例: 営業許可（主題）と営業停止命令（関連）
   - テーマに関連するが別の規定

4. 選択肢D は 「微妙な誤り」
   - 特徴: 上級者のみが正誤を判別できる難度
   - 例: 一部は正しいが範囲や条件が異なる
   - 詳しい学習者を引き付ける

【ひっかけ度の制御】

テンプレート別に、正答の選択率を以下に制御してください：

T1: 正答選択率 85% （ひっかけ度 15%）
  → 大多数が正答を選べる明確な問題

T2: 正答選択率 65% （ひっかけ度 35%）
  → 標準難易度（正答には理由があるが誤りも説得力あり）

T3: 正答選択率 55% （ひっかけ度 45%）
  → 応用難易度（4択すべてに説得力、慎重な判断が必要）

T4: 正答選択率 65% （ひっかけ度 35%）
  → 複合条件で混同させるが標準難易度

T5: 正答選択率 55% （ひっかけ度 45%）
  → 実務知識を要する高難易度

【品質チェックリスト】

各問題を生成した後、以下を確認してください：

☑ 正答は根拠が明確か（条文・教材から導ける）
☑ 選択肢B は「学習者の典型的な誤解」か（似た用語の混同など）
☑ 選択肢C は「関連するが異なる概念」か
☑ 選択肢D は「微妙な誤り」か（詳しい者のみ判別可能）
☑ 4択すべてに「選ばれる可能性」があるか
☑ ひっかけ度がテンプレート別目標値に近いか
☑ 複合語46個の分割・変更がないか
☑ 説明文は根拠を明示しているか
```

### **ユーザープロンプト（Claude API呼び出し時）強化版**

```
【強化版プロンプト例】

技術管理分野のT3 (ひっかけ)テンプレートで、難易度「応用」の問題を生成してください。

【重要な制約】
- ひっかけ度: 40-50%の範囲内（正答選択率 50-60%）
- 4択すべてが「選ばれる可能性」を持つこと
- ディストラクタの品質: 正答と同等レベルの説得力

【チャンクコンテキスト】
[実際のチャンク内容]

【品質基準】
- 正答: 確実に正しい（根拠: XXX条項など）
- 選択肢B: 似た規定だが異なる（XX と混同しやすい）
- 選択肢C: 関連概念だが別（XX に関連するが異なる）
- 選択肢D: 微妙な誤り（一部は正しいが YY が不正確）

以下の JSON 形式で返してください：
{
  "problem_id": "technology_T3_001",
  "domain": "technology",
  "template": "T3",
  "difficulty": "応用",
  "question": "...",
  "options": {
    "A": "... （正答）",
    "B": "... （典型的な誤り）",
    "C": "... （関連概念の誤り）",
    "D": "... （微妙な誤り）"
  },
  "correct_answer": "A",
  "explanation": "...",
  "source_theme": "theme_XXX",
  "compound_words_used": ["複合語1"],
  "distractor_strength": 0.45
}
```

---

## ✅ **実装チェックリスト（Week 7開始前）**

### **Step 1: システムプロンプト更新（30分）**

```bash
# WEEK7_EXECUTION_GUIDE.md の以下を更新:

Step 2.1 ユーザープロンプト → 上記強化版を使用

例:
  "【重要な制約】
  - ひっかけ度: 40-50%の範囲内
  - 4択すべてが『選ばれる可能性』を持つこと
  - ディストラクタの品質: 正答と同等レベルの説得力"
```

### **Step 2: 試験生成（5-10問）**

```bash
# 強化版プロンプトで5-10問を試験生成
# 各テンプレート (T1, T2, T3, T4, T5) から1-2問ずつ

出力ファイル: output/technology_domain_test_5problems.json
```

### **Step 3: 品質評価**

```bash
# 以下を確認:
□ 正答は根拠が明確か
□ ディストラクタの説得力があるか（4択が拮抗）
□ ひっかけ度がテンプレート別範囲内か
□ 複合語が正確に使用されているか
```

### **Step 4: 調整・最適化（30分）**

```bash
# 必要に応じて:
□ プロンプトの調整
□ 温度（temperature）パラメータの設定確認
□ 選択肢の質の改善例を追加
```

### **Step 5: 本生成開始（Week 7）**

```bash
# 調整版で150問を本生成
```

---

## 📈 **期待される改善効果**

```
【現在】
総合スコア: 0.727点

【改善後推定】
総合スコア: 0.78-0.82点（優秀）

【内訳】
明確性: 0.79 (変化なし)
ディストラクタ: 0.80 (+0.085改善) ✅
根拠性: 0.88 (変化なし)
ひっかけ度: 0.70 (+0.20改善) ✅
```

---

**品質最優先で実装してください。**
**Week 7本生成は、このガイドに基づいて実施してください。**

